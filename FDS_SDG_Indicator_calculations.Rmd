---
title: "FDS Questionnaire v1 SDG Indicator calculations"
author: "Global Survey Team"
output: unhcrdown::html_page
unhcrdown::html_page:
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval=FALSE)
```


Date: Last revision was in January 2025

*For any issues please contact Ilgi Bozdag at bozdag@unhcr.org or Petra Kaps at kaps@unhcr.org*

**Important Instructions**

1. For correct calculations, ensure you have five datasets named: 'HHroster', 'main', 'RA_adult', 'RA_caregiver', 'RA_woman'.  

2. Confirm that your datasets are cleaned and weighted as required for accurate results!


Ilgi/Petra - Add Github links once done

# Sustainable Development Goals

[The 2030 Agenda for Sustainable Development](https://sdgs.un.org/2030agenda), adopted by all United Nations Member States in 2015, provides a shared blueprint for peace and prosperity for people and the planet, now and into the future. At its heart are the 17 Sustainable Development Goals (SDGs), which are an urgent call for action by all countries - developed and developing - in a global partnership. They recognize that ending poverty and other deprivations must go hand-in-hand with strategies that improve health and education, reduce inequality, and spur economic growth – all while tackling climate change and working to preserve our oceans and forests. 


There is broad consensus around the key indicators used to measure, inform and monitor progress towards global development objectives, as exemplified by the Sustainable Development Goals and related efforts of the MICS, DHS, IHSN, together with national governments.
UNHCR's objectives are largely aligned with these frameworks.

[The Forced Displacement Survey (FDS)](https://www.unhcr.org/what-we-do/reports-and-publications/data-and-statistics/forced-displacement-survey) is a programme designed to streamline and standardize surveys that collect data on forcibly displaced people.

FDS is a household-level survey with standard questionnaires following context-appropriate methodological approaches.The FDS collects multi-topic data on the socioeconomic and living conditions of refugees, asylum-seekers and nationals who live in proximity (host communities).  The main topics covered by the FDS can be broadly classified into four areas: demographics and legal status, socio-cultural, economic and civil-political.


FDS help us to SDG indicators in a standardized way to have a global understanding of the results. Both indicators and questionnaire is also largely aligned with MICS, DHS, IHSN, national household surveys and other standardized UNHCR surveys.

This document will guide you on how each and every indicator will be calculated with the FDS standard questionnaire module corresponding to each indicator.

**Population** refers to survey population in this guidance for the calculation of indicators as shown by numerator and denominator.

**How to calculate an indicator?** In the calculation of a percentage or rate, the denominator is often the total number of observations, events, or units in the population or sample being studied. The numerator, on the other hand, represents the specific part or subset of interest.

Percentage = \(\left(\frac{\text{Numerator}}{\text{Denominator}}\right) \times 100\)

**Description of the datasets**

The FDS consists of 4 questionnaires and an introduction section which together form the FDS interview. The 4 questionnaires and the respective modules in each are the following: 

**- Head of the Household questionnaire**, responded to by the head of the household (>= 15 years of age), it includes all household level questions such as access to services. This questionnaire also includes the household roster, where the head of the household responds to individual level questions about all household members.  

***Head of the Household - Household Roster***

HH definition  
Identification module  
HH Roster (including education & language)  
Banking for HH Roster  
Disability   
 
***Head of the Household***

Legal Status 2 
Displacement History  
Shelter  
WASH  
Clean Energy  
Assets  
Mosquito Nets  
Land and Property  
Food and Nutrition  
Objective Wellbeing   
Experience of Shocks  
Social Protection  
Child Labor  


**- Random Adult questionnaire**, responded to by the randomly selected adult (>= 15 years of age) from the household.

Subjective and Mental Wellbeing  
Aspiration   
Healthcare   
Mental Health  
Mobility  
Education 2  
Skills   
Employment  
Job Search   
Time Spent on Domestic Work   
Trust - Political Participation  
Financial Solutions  
Remittances  
Access to Information  
Freedom of thought  
Feel Safe Walking Alone  
Access to Justice  
Acceptance between communities  
Discrimination  
Victimization  

**- Random Woman questionnaire**, responded to by the randomly selected woman (>= 15 years of age) who gave birth in the last 2 years.

Women’s health - Birth attendance  
Family Planning  
Menstrual Hygiene  

**- Caregiver questionnaire**, responded to by the caregiver of the randomly selected child (<5 years of age) from the household.

Anthropometrics
Immunization 

Data is organized in 5 datasets, which are connected through an unique identifier "uuid". The 5 datasets are the following: 

- *HHroster* = Roster section from questionnaire responded to by the head of the household 

- *main* = Questionnaire responded to by head of the Household 

- *RA_adult* = Questionnaire responded to by the randomly selected adult 

- *RA_woman* = Questionnaire responded to by the randomly selected woman

- *RA_caregiver* = Questionnaire responded to by the caregiver of the randomly selected child


At this step, you should already have all five datasets structured in a way that will allow you to calculate your indicators as you will be guided in this document. It's not recommended to clear your work space if your datasets are already loaded. 


```{r, eval=FALSE}
## Install pacman if not already installed
if(!require(pacman)) install.packages('pacman')

## Load all required libraries using pacman
pacman::p_load(
  tidyverse, dplyr, tidyr, rlang, purrr, magrittr, expss, srvyr,
  readr,labelled,pastecs,psych,tableone, outbreaks, ggplot2, unhcrthemes,
  scales, gt,webshot2, sjlabelled, waffle, writexl,remotes, haven )
```
```{r, eval=FALSE}
##Upload cleaned and weighted datasets 

HHroster <- read_dta("HHroster.dta")
main <- read_dta("main.dta")
RA_adult <- read_dta("RA_adult.dta")
RA_woman <- read_dta("RA_woman.dta")
RA_caregiver <- read_dta ("RA_caregiver.dta")
```

## Standardized Disaggregation Variables

**Population Group**
```{r, eval=FALSE}

table(HHroster$Intro_07)     #in dataset "HHroster". 
table(main$Intro_07)         #in dataset "main". 
table(RA_adult$Intro_07)     #in dataset "RA_adult". 
table(RA_woman$Intro_07)     #in dataset "RA_woman". 
table(RA_caregiver$Intro_07) #in dataset "RA_caregiver". 
```

**Age**
```{r, eval=FALSE}
# Main age variable
summary(HHroster$agetouse) #Main age variable at individual level can be found in the dataset "HHroster". 

#2 categories (<18, >18)
table(HHroster$HH_04_cat2) #in dataset "HHroster".

#4 categories (0-4, 5-17, 18-59, 60+)
table(HHroster$HH_04_cat4) #in dataset "HHroster".

#We look at age categories only for indicators for which data is pulled from the "HHroster" dataset, which holds the individual data for all members of the household. For other four datasets (Head of the household, randomly selected adult, randomly selected woman, and randomly selected caregiver) the respondent is always => 15 years of age. 

summary(main$HH_04_HoH)           #in dataset "main".
summary(RA_adult$age_selected)   #in dataset "RA_adult".
summary(RA_woman$agerandomwoman) #in dataset "RA_woman".
summary(RA_caregiver$HH_04_RC)   #in dataset "RA_caregiver".
```

**Gender**
```{r, eval=FALSE}
table(HHroster$HH_02)          #in dataset "HHroster".
table(main$HH_02_HoH)         #in dataset "main". 
table(RA_adult$HH_02_RA)     #in dataset "RA_adult".
table(RA_caregiver$HH_02_RC) #in dataset "RA_caregiver".
```


**Disability**
```{r, eval=FALSE}
table(HHroster$disability)          #in dataset "HHroster".
table(main$disability_HoH)         #in dataset "main". 
table(RA_adult$disability_RA)     #in dataset "RA_adult".
table(RA_woman$disability_RW)     #in dataset "RA_woman".
table(RA_caregiver$disability_RC) #in dataset "RA_caregiver".
```


**Country of origin**
```{r, eval=FALSE}
table(HHroster$COO)          #in dataset "HHroster".
table(main$COO_HoH)         #in dataset "main".
table(RA_adult$COO_RA)     #in dataset "RA_adult".
table(RA_woman$COO_RW)     #in dataset "RA_woman".
table(RA_caregiver$COO_RC) #in dataset "RA_caregiver".

```


#Indicators 


## 1.3.1 SDG Indicator

**Proportion of population covered by social protection floors/systems, by sex, distinguishing children, unemployed persons, older persons, persons with disabilities, pregnant women, newborns, work-injury victims and the poor and the vulnerable**


Indicator Code: C010301


The indicator reflects the proportion of persons effectively covered by a social protection system, including social protection floors. It also reflects the main components of social protection: child and maternity benefits, support for persons without a job, persons with disabilities, victims of work injuries and older persons.
Effective coverage of social protection is measured by the number of people who are either actively contributing to a social insurance scheme or receiving benefits (contributory or non-contributory).

SDG Indicator 1.3.1 and ILO methodology includes child, family and maternity benefits; support for people without jobs, people with disabilities, victims of work injuries and older people.

Calculations include separate indicators in order to distinguish effective coverage for children, unemployed persons, older persons and persons with disabilities, mothers with newborns, workers protected in case of work injury, and the poor and the vulnerable. For each case, coverage is expressed
as a share of the respective population. FDS can only cover part of the indicators.


|    Standard Questions                                  |
|:------------------------------------------------------:|
| ScProtec01, ScProtec04, ScProtec16                     |

**Sources**  
1.[SDG 1.3.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-01-03-01a.docx&wdOrigin=BROWSELINK)

Indicators are obtained as follows:

a) Proportion of population covered by at least one social protection cash benefit: ratio of the population receiving cash benefits under at least one of the contingencies/social protection functions (contributory or non-contributory benefit) or actively contributing to at least one social security scheme to the total population.




```{r, eval=FALSE}

#Check variables 

table(main$ScProtec01) #In the past 12 months while in the host country, have you or anyone in your household received support from any assistance programme?
table(main$ScProtec04) #From whom have you or anyone in your household received the assistance provided by this programme?
#ScProtec16: In the last 12 months, have you or anyone in your household received any of the following payments from the host country government?  
table(main$ScProtec16a)#Social protection cash benefit
table(main$ScProtec16b)#Parental/Maternity benefit
table(main$ScProtec16c)#Disability benefit
table(main$ScProtec16d)#Unemployment benefit
table(main$ScProtec16e)#Employment injury benefit
table(main$ScProtec16f)#Sickness benefit
table(main$ScProtec16g)#Old-age pension
table(main$ScProtec16h)#Other vulnerability benefit
table(main$ScProtec16i)#Social assistance cash benefit

```
```{r, eval=FALSE}
#Step 2: Create a new variable to check if the household receives any social protection benefit in the form of payment from the government

main <- main %>%
  rowwise() %>%
  mutate(Social_Benefit = case_when(
    any(c_across(starts_with("ScProtec16")) == 1, na.rm = TRUE) ~ 1,  # If any column has 1
    all(c_across(starts_with("ScProtec16")) == 2, na.rm = TRUE) ~ 2,  # If all columns are 2
    TRUE ~ 2                                                   # Default to NA
  )) %>%
  ungroup()
```

```{r, eval=FALSE}
table(main$Social_Benefit)
```


b) Proportion of children covered by social protection benefits: ratio of children/households receiving child or family cash benefits to the total number of children/households with children.


```{r, eval=FALSE}
#not possible from the FDS
```

c) Proportion of women giving birth covered by maternity benefits: ratio of women receiving cash maternity benefits to women giving birth in the same year (estimated based on age-specific fertility rates published in the UN’s World Population Prospects or on the number of live births corrected for the share of twin and triplet births).

```{r, eval=FALSE}
#add here only ScProtec16b - Parental/Maternity benefit
```


d) Proportion of persons with disabilities receiving benefits: ratio of persons receiving disability cash benefits to persons with severe disabilities. The latter is calculated as the product of prevalence of disability ratios (published for each country group by the World Health Organization) and each country’s population.

```{r, eval=FALSE}
#check disability benefit compared with disability definition in the questionnaire 
```

e) Proportion of unemployed receiving benefits: ratio of recipients of unemployment cash benefits to the number of unemployed persons.

```{r, eval=FALSE}
#check unemployed benefit from below and compare with unemployment definition
```

f) Proportion of workers covered in case of employment injury: ratio of workers protected by injury insurance to total employment or the labour force.


```{r, eval=FALSE}
# not in FDS
```

g) Proportion of older persons receiving a pension: ratio of persons above statutory retirement age receiving an old-age pension to persons above statutory retirement age (including contributory and non-contributory).

```{r, eval=FALSE}
# calculate old people from the main dataset /
```

h) Proportion of vulnerable persons receiving benefits: ratio of social assistance recipients to the total number of vulnerable persons. The latter are calculated by subtracting from total population all people of working age who are contributing to a social insurance scheme or receiving contributory benefits, and all persons above retirement age receiving contributory benefits.

```{r, eval=FALSE}
#vulnerability benefit is there but - not possible from the FDS
```

i) Proportion of poor population receiving social assistance cash benefit: ratio of social assistance recipients to the population living below the national poverty line.

```{r, eval=FALSE}
#Not possible as poverty is not defined
```



## 1.4.1 SDG Indicator

**Proportion of population living in households with access to basic services**

Indicator Code: C010401


The proportion of population living in households with access to basic services is defined as the proportion of population using public service provision systems that meet basic human needs including drinking water, sanitation, hygiene, energy, mobility, waste collection, health care, education and information technologies. The basic services indicator is therefore based on 9 components.

In FDS, we are only able to calculate a proxy, as we are not able to calculate the access to all 9 components. This indicator will be measured through 4 components: Access to basic health care services, access to basic drinking water services, access to basic hygiene facilities and access to clean fuels and technology. 

| Services           | Variables                                                             |
|--------------------|:---------------------------------------------------------------------:|
| Health             |BA4, BA6_1, MV7, MV8, MN05_2, MN05_3, HH_13,SAN01, SAN02, SAN03, SAN05 |                                                    
| Drinking water     |BD01, BD01a, BD20_2, BD20_3 BD22                                       |
| Hygiene            |HW2_OB, HW3_OB, HW4_OB, HW8_OB                                         |
| Clean Energy       |HC01, HC02, HC04                                                       |
                                        


### Calculate variables for access to four basic services {.tabset}

**Click on services below to see how they are calculated**

#### Drinking water
Access to Basic Drinking Water Services refers to the use of drinking water from an improved source with a collection time of not more than 30 minutes for a round trip, including queuing. ‘Improved’ drinking water sources include the following:: piped water, boreholes or tube wells, protected dug wells, protected springs, rainwater, water kiosks, and packaged or delivered water. This definition is based on the WHO/UNICEF Joint Monitoring Programme (JMP) drinking water ladder. 

1. Improved water source.
2. The main water source is located within the household's dwelling or yard, or it is reachable within a 30-minute round trip, including any time spent queuing.

**Numerator**: Individuals using drinking water from an improved source, provided collection time is not more than 30 minutes for a round trip, including queuing. 

**Denominator**: Total number of individuals

**Dataset**: main

**Sources**  
1.[SDG 1.4.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-01-04-01.docx&wdOrigin=BROWSELINK)
2.[JMP WASH guidance](https://washdata.org/sites/default/files/documents/reports/2019-03/JMP-2018-core-questions-for-household-surveys.pdf).

```{r, eval=FALSE}
##Step 1: Check all variables
table(main$BD01)   ##What is the main source of drinking water used by members of your household?
table(main$BD01a)  ##Where is this main drinking water source located? In your own dwelling, in your own yard or plot , or elsewhere?
table(main$BD20_2) ##How long does it take for members of your household to go to the main source of drinking water, stay in a queue, get water, and come back? Please do not include time spent socializing. 
table(main$BD20_3) ##Specifying minutes on how long it takes to collect water 
table(main$BD22)   ##Does it take more or less than 30 minutes?


## Step 2: Add a column specifying if the household uses improved or unimproved source of drinking water 
main <- main %>%
mutate(Improved_dw = ifelse(BD01 %in% c(11, 12, 13, 14, 21, 31, 41, 51, 61, 71, 72, 91, 92), 1, 0)) %>%
  mutate(Improved_dw = labelled(Improved_dw,
                               labels = c(
                                 "Yes" = 1,
                                 "No" = 0
                               ),
                               label = "Improved drinking water source"))

##Step 3: Add a coloumn specifying if the improved water source is located in own dwelling/yard/plot or elsewhere. 
main <- main %>%
mutate(Improved_dw_Loc = case_when(
BD01 %in% c(11, 12) ~ 1, #Assigns 1 if piped into dwelling/yard/plot
BD01 %in% c(13, 14, 21, 31, 41, 51) & BD01a %in% c(1, 2) ~ 1, #Assigns 1 if other source located in HH dwelling or plot
BD01 %in% c(13, 14, 21, 31, 41, 51) & BD01a == 3 ~ 0))%>% #Assigns 2 if other source located elsewhere
mutate(Improved_dw_Loc = labelled(Improved_dw_Loc,
                               labels = c(
                                 "Own dwelling/yard/plot" = 1,
                                 "Elsewhere" = 0
                               ),
                               label = "Improved drinking water source in own dwelling, yard or plot"))

##Step 4: Add a coloumn specifying if it takes more or less than 30 min to the improved drinking water source. If the improved drinking water source is located in own dwelling, yard or plot, it is considered that it takes less than 30 minutes to reach. 
## BD20_3 - Minutes

main <- main %>%
  mutate(
    Improved_dw_access = case_when(
      BD01 %in% c(11, 12,91,92) ~ 1, #Assigns 1 if improved water source is "Piped to plot/yard/dwelling", "Bottled water" or "Sachets". 
      BD01 %in% c(13, 14, 21, 31, 41, 51, 61, 71, 72) & ((BD20_2 == 1 & BD20_3 < 30) | (BD20_2 == 98 & BD22 == 1)) ~ 1, #Assigns 1 if other improved water source which are reachable in less than 30 minutes. 
      TRUE ~ 0))%>% #Assigns 0 in all other cases. 
mutate(Improved_dw_access = labelled(Improved_dw_access,
                               labels = c(
                                 "Yes" = 1, 
                                 "No" = 0
                               ),
                               label = "Improved water source located reachable in less than 30min"))
      
      
main <- main %>%
  mutate(
    Improved_dw_final = case_when(
      Improved_dw == 1 & (Improved_dw_Loc == 1 | Improved_dw_access == 1)~ 1, #Assigns 1 when an improved water source is located on premises or reachable in less than 30 min. 
      TRUE ~ 0
    )
  ) %>%
  mutate(Improved_dw_final = labelled(Improved_dw_final,
                               labels = c(
                                 "Yes" = 1, 
                                 "No" = 0
                               ),
                               label = "Access to clean drinking water services"))



table(main$Improved_dw_final)


```


#### Hygiene Facilities

The proportion of the population with basic hygiene services is defined as the proportion of population with a handwashing facility with soap and water available at home. Handwashing facilities may be located within the dwelling, yard or plot. They may be fixed or mobile and include a sink with tap water, buckets with taps, tippy-taps, and jugs or basins designated for handwashing. Soap includes bar soap, liquid soap, powder detergent, and soapy water but does not include ash, soil, sand or other handwashing agents.

**Unit of observation**: Household

**Numerator**:  Number of individuals with access to with basic handwashing facilities on premises

**Denominator**: Total number of individuals

**Dataset**: main

**Sources**  
1.[SDG 6.2.1a Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-06-02-01b.docx&wdOrigin=BROWSELINK)
2.[JMP Methodology](https://washdata.org/reports/jmp-2017-methodology)

```{r, eval=FALSE}
table(main$HW2_OB) #Can you please show me where members of your household most often wash their hands?
table(main$HW3_OB) #Observe presence of water at the place for hand washing. Verify by checking the tap/pump, or basin, bucket, water container or similar objects for presence of water.
table(main$HW4_OB) #Is soap or detergent or ash/mud/sand present at the place for hand washing?
table(main$HW8_OB) #Type of soap
```


```{r, eval=FALSE}
#Step 1: Create a variable which checks for the type of hand washing facility

main <- main %>%
  mutate(handwashing_type = case_when(
    HW2_OB  %in% c(1,2,3) ~ 1, #Assigns 1 when the observed hand washing facility is fixed facility (sink,tap) in yard/plot/dwelling or mobile hand washing facility
    HW2_OB %in% c(4,96) ~ 0, #Assigns 0 when there is no hand washing facility observed in dwelling/yard/plot or when the answer is other,specify
    HW2_OB == 5 ~ NA )) #Assigns NA where the permission to observe the hand washing facility is not given

#Step 2: Create a variable checking for the presence of water
main <- main %>%
  mutate(handwashing_water = case_when(
    HW3_OB == 1 ~ 1, #Assigns 1 when water is present
    HW3_OB == 2 ~ 0)) #Assigns 0 when water is not present
    
#Step 3: Create a variable checking for the presence and type of soap
main <- main %>%
  mutate(handwashing_soap = case_when(
    HW4_OB == 1 & HW8_OB %in% c("A","B")~ 1, #Assigns 1 when soap is present and type is bar soap, liquid soap, powder detergent, and soapy water
    HW4_OB == 1 & HW8_OB %in% c("C")~ 0, #Assigns 0 when soap is present and type is ash, soil, sand
    HW4_OB == 2 ~ 0)) #Assigns 0 when soap is not present

#Step 4: Combine all 3 conditions to a final variable
main <- main %>%
  mutate(handwashing_facility = case_when(
    handwashing_type == 1 & handwashing_water == 1 & handwashing_soap == 1 ~ 1,
    handwashing_type == 0 | handwashing_water == 0 | handwashing_soap == 0 ~ 0))%>%
  mutate(handwashing_facility = labelled(handwashing_facility,
                                labels = c(
                                  'Yes' = 1,
                                  'No' = 0
                                ),
                                label = "Proportion of people with basic hygiene services "))

table(main$handwashing_facility)

```

#### Clean fuels and technology

Proportion of population with primary reliance on clean fuels and technology is calculated as the number of people using clean fuels and technologies for cooking, heating and lighting divided by total population reporting that any cooking, heating or lighting, expressed as percentage. “Clean” is defined by the emission rate targets and specific fuel recommendations (i.e. against unprocessed coal and kerosene) included in the normative guidance WHO guidelines for indoor air quality: household fuel combustion. The indicator is based on the main type of fuel and technology used for cooking as cooking occupies the largest share of overall household energy needs.

**Unit of observation**: Household

**Numerator**:   Number of individuals using clean fuel and technology as their primary source of cooking

**Denominator**: Total number of individuals

**Dataset**: main

To calculate the indicator value, the standard survey methodology considers in the numerator only individuals in households that use one of the following most of the time as their source for cooking are considered in the numerator:

  + solar cooker
  + electric stove
  + piped natural gas stove
  + biogas stove
  + LPG/cooking gas stove
  + liquid fuel stove with alcohol / ethanol.

**Sources**  
1.[SDG 7.1.2 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-07-01-02.docx&wdOrigin=BROWSELINK)
2.[World Bank LSMS Energy guidance](https://documents1.worldbank.org/curated/en/557341633679857128/pdf/Measuring-Energy-Access-A-Guide-to-Collecting-Data-Using-the-Core-Questions-on-Household-Energy-Use.pdf)


```{r, eval=FALSE}
#Step 1: Calculate clean fuel for cooking 
table(main$HC01) #Is any food or drink consumed by household members cooked or prepared at the household dwelling using a cookstove, fire or other cooking device?
table(main$HC02) #What does this household use for cooking most of the time, including cooking food, making tea/ coffee, boiling drinking water?
table(main$HC04) #What type of fuel or energy source does this household use most of the time in this ${HC02_response} for cooking food, making tea/coffee and boiling drinking water?

main <- main %>%
  mutate(
    clean_cook = case_when(
      (HC01 == 1 & (HC02 %in% c(1, 2, 3, 4, 5)) | (HC01 == 1 & HC02 == 8 & HC04 == 2)
      ) ~ 1,  # First condition for clean cooking
      (HC01 == 1 & (HC02 %in% c(6,7,9,10,11,96)) | (HC02 == 8 & !(HC04== 2)
      )) ~ 0,  # Condition for unclean cooking or incomplete clean technology
      HC01 == 2 ~ 0,  # HC01 is "2"
      TRUE ~ NA_real_  # Handle missing or other cases
    )
  ) 
```
```{r, eval=FALSE}
table(main$clean_cook)
```

```{r, eval=FALSE}
#Step 2: Calculate clean fuel for heating
table(main$HHT01) #Does this household use any heating device or fire to keep the dwelling/living quarters warm at any time during the year?
table(main$HHT04) #What kind of device does this household use to heat the home when needed? For example, do you use a space heater(s), or use your cookstove in the winter for warmth?
table(main$HHT06) #What type of fuel or energy source does this household use **most of the time for heating** in ${HHT04_response}?
```

```{r, eval=FALSE}
#Note that the following types of heating: manufactured space heater, traditional space heater, manufactured cookstove and traditional cookstove are only considered clean when the brand of them is considered a clean brand based on the WHO guidelines. However we do not have the needed information to classify a brand as clean or unclean. Therefore households that use these types of heating have been classified as clean without including the brand names in the calculation. 
main <- main %>%
  mutate(
    clean_heating = case_when(
      HHT01 == 1 & HHT04 %in% c(1, 2, 3, 4, 5, 8) ~ 1, # Clean heating
      HHT01 == 1 & HHT04 %in% c(6, 7, 96) ~ 0,         # Unclean heating
      HHT01 == 2 ~ 0,                                  # No heating used
      TRUE ~ NA_real_                                  # Missing or other cases
    )
  )

```
```{r, eval=FALSE}
table(main$clean_heating)
```

```{r, eval=FALSE}
#Step 3: Calculate clean lightning
table(main$HL01) #Does this household use anything for lightning? 
table(main$HL03) # What does this household use **most of the time** as energy for lighting, or as a light source?
main <- main %>%
  mutate(
    clean_lightning = case_when(
      HL01 == 1 & HL03 %in% c(1, 2, 3, 4, 5, 6) ~ 1, # Clean lighting
      HL01 == 1 & HL03 %in% c(7,9,9,10,11,96) ~ 0,   # Unclean lighting
      HL01 == 2 ~ 0,                                  # No lighting
      TRUE ~ NA_real_                                  # Missing or other cases
    )
  )

```
```{r, eval=FALSE}
table(main$clean_lightning)
```

```{r, eval=FALSE}
#Step 4: Combine the three conditions above into a final indicator
main <- main %>%
  mutate(
    clean_fuel = case_when(
      clean_cook == 1 & clean_heating == 1 & clean_lightning == 1 ~ 1,
      clean_cook == 0 | clean_heating == 0 | clean_lightning == 0 ~ 0))
  
```
```{r, eval=FALSE}
main <- main %>%
   mutate(clean_fuel = labelled(clean_fuel,
                                labels = c(
                                  "Clean fuel" = 1,  # Label for Yes
                                  "Unclean fuel" = 0   # Label for No
                                ),
                                label = "Proportion of population with primary reliance on clean fuels and technology"))
```

#### Health care services
Coverage of essential health services (defined as the average coverage of essential services based on tracer interventions that include reproductive, maternal, newborn and child health, infectious diseases, non-communicable diseases and service capacity and access, among the general and the most disadvantaged population).

Concepts:

The index of health service coverage is computed as the geometric means of 14 tracer indicators and expressed as a UHC Service Coverage Index. 4 health service areas, and 14 tracer indicators are the following:

I. Reproductive, maternal, newborn and child health (family planning,pregnancy care,child immunization, child treatment)
II. Infectious disease (tuberculosis, HIV/AIDS, Malaria, WASH)
III. Noncommunicable diseases (Hypertension, diabetes, tobacco)
IV. Service capacity and access (hospital access, health workers, health security)

In FDS, we are able to evaluate two health service areas, area I. and II. through 4 tracer indicators - on pregnancy care, child immunization, malaria, WASH. Therefore the final indicator calculation results in a proxy for SDG 3.8.1 

| Tracers            | Variables                                                            |
|--------------------|:--------------------------------------------------------:            |
| Pregnancy care     |BA4, BA6_1                                                            |                                                    
| child immunization |MV7, MV8                                                              |
| Malaria            |MN05_2, MN05_3, HH_13                                                 |
| WASH               |SAN01, SAN02, SAN03, SAN05                                            |


**Sources**  
1.[SDG 3.8.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-03-08-01.docx&wdOrigin=BROWSELINK)

##### Calculate variables for tracer indicators {.tabset}

##### Pregnancy care

Percentage of women aged 15-49 years with a live birth in a given time period who received antenatal care four or more times.

**Unit of observation**: Individual

**Numerator**: Number of women aged 15−49 years with a live birth in a given time period who received antenatal care four or more times

**Denominator**: Total number of women aged 15−49 years with a live birth in the same period (last 2 years in FDS)

**Dataset**: RA_woman


```{r, eval=FALSE}
table(RA_woman$BA4) #Did you see anyone for a follow-up visit during your last pregnancy?
table(RA_woman$BA6_1) #Overall during your pregnancy, how many times did you have a follow-up visit with a health professional?
```

```{r, eval=FALSE}
#Step 1: Create a variable assessing if women aged 15−49 years with a live birth in the last 2 years received antenatal care four or more times
RA_woman <- RA_woman %>%
  mutate(
    pregnancy_care = case_when(
      BA4 == 1 & BA6_1 >= 4 ~ 1,           # Assign 1 when antenatal care was received 4 or more times
      BA4 == 2 ~ 0,                        # Assign 0 when no antenatal care was received
      BA4 == 1 & BA6_1 < 4 ~ 0))           # Assign 0 when antenatal care was received less than 4 times
      
```
```{r, eval=FALSE}
#Step 2: Calculate the percentage of women aged 15−49 years with a live birth in the last 2 years who received antenatal care four or more times
antenatal_care_per <- RA_woman %>%
  filter(!is.na(pregnancy_care)) %>%  # Exclude rows with NA in pregnancy_care
  summarise(
    total_women = n(),  # Total number of women in the denominator
    received_anc4_count = sum(pregnancy_care, na.rm = TRUE),  # Count of women in the numerator
    percentage = (received_anc4_count / total_women) * 100  # Percentage calculation
  ) %>%
  pull(percentage)

# Print the result
cat("The percentage of women aged 15−49 years with a live birth in the last 2 years who received antenatal care four or more times is:", antenatal_care_per, "%\n")
```

##### Child immunization

Percentage of infants receiving three doses of diphtheria-tetanus-pertussis containing vaccine

**Unit of observation**: Individual

**Numerator**: Children 1 year of age who have received three doses of diphtheria-tetanus-pertussis containing vaccine

**Denominator**: All children 1 year of age

**Dataset**: RA_caregiver

```{r, eval=FALSE}
table(RA_caregier$MV7)  #Has the child received Pentavalent vaccine (DPT + Hep B + Hib) that is, three shots in the arm by the age of 14 weeks - to prevent from getting Diphtheriae, Pertussis, Tetanus, Hepatitis B and Haemophilus Influenza type B - HIB)
table(RA_caregiver$MV8) #How many times did the child receive the Pentavalent vaccine?
summary(RA_caregiver$child_age_immunization) #Age of the child 
```

```{r, eval=FALSE}
#Step 1: Create a variable assessing if the children 1 year of age have received three shots of pentavalent vaccine
RA_caregiver <- RA_caregiver %>%
  mutate(
    child_immunization = case_when(
      (child_age_immunization >= 12 & child_age_immunization <= 23) & MV7 %in% c(1, 2) & MV8 >= 3 & MV8 != 98 ~ 1, # 1 for yes
      (child_age_immunization >= 12 & child_age_immunization <= 23) & MV7 == 3 ~ 0,  # 0 for No
      TRUE ~ NA_real_  # Assign NA for MV7 == 98 or any other conditions
    )
  )           
      
```
```{r, eval=FALSE}
#Step 2: Calculate the percentage of infants receiving three doses of diphtheria-tetanus-pertussis containing vaccine

child_immun_per <- RA_caregiver %>%
  filter(!is.na(child_immunization)) %>%  # Exclude rows with NA in child_immunization
  summarise(
    child_immun_per = (sum(child_immunization, na.rm = TRUE) / n()) * 100  # Calculate the percentage
  ) %>%
  pull(child_immun_per)

cat("The percentage of children receiving three doses of the DTP-containing vaccine is:", child_immun_per, "%\n")

```
##### Malaria prevention

Percentage of population in malaria-endemic areas who slept under an ITN the previous night.

**Unit of observation**: Individual (based on household size)

**Numerator**: Number of people in malaria-endemic areas who slept under an ITN

**Denominator**: Total number of people in malaria endemic areas.

**Dataset**: main

```{r, eval=FALSE}
table(main$MN05_2) #You told me that X people slept under [bednets/mosquito nets] last night, how many of them slept under treated [bednets/mosquito nets]?
table(main$MN05_3) #You told me that one person slept under [bednets/mosquito nets] last night, did this person sleep under treated [bednets/mosquito nets]?
table(main$HH_13)  #Did you sleep here last  night? 
```


```{r, eval=FALSE}
#Step 1: Create a composite variable to capture the number of people that slept under ITN in the household, the previous night.
main <- main %>%
  mutate(
    final_sleep_ITN = case_when(
      !is.na(MN05_2) ~ MN05_2,  # Take MN05_2 if it is not empty
      is.na(MN05_2) & !is.na(MN05_3) ~ MN05_3,  # Take MN05_3 if MN05_2 is empty but MN05_3 is not
      is.na(MN05_2) & is.na(MN05_3) ~ NA_real_  # Assign NA if both are empty
    )
  )
```

```{r, eval=FALSE}
#Step 2: Calculate the total number of household members who slept it the household the night before 
HHroster <- HHroster %>%
mutate(
    sleep_HH = case_when(
      member == 1 & HH_13 == 1 ~ 1, 
      TRUE ~ NA_real_))

mosquito_members <- HHroster %>%
  group_by(uuid) %>%
  summarise(
    totalmembermosq = if (all(is.na(sleep_HH))) NA_real_ else sum(sleep_HH == 1, na.rm = TRUE)
  )

# Join with the main data set
main <- main %>%
  left_join(mosquito_members, by = "uuid")
```

```{r, eval=FALSE}
#ILGI: This is the start of the calculation at a household level - % of people in each household that slept under an ITN the night before. 
#Step 3: Calculate the % of people that slept under mosquito nets in each household 
main <- main %>%
  mutate(
    sleep_ITN_HH = case_when(
      !is.na(final_sleep_ITN) & !is.na(totalmembermosq) ~ final_sleep_ITN/totalmembermosq,  
      is.na(final_sleep_ITN) | is.na(totalmembermosq) ~ NA_real_))  # NA if nominator or denominator are NA
 

```
```{r, eval=FALSE}
# Calculate the average percentage, ignoring NAs
average_sleep_ITN <- main %>%
  summarise(
    avg_sleep_ITN_HH = mean(sleep_ITN_HH, na.rm = TRUE)
  )

avg_value <- (average_sleep_ITN$avg_sleep_ITN_HH)*100

# Print the result
print(average_sleep_ITN)
cat("The average % of people per household who slept under ITN the previous night is:", avg_value, "%\n")

```
```{r, eval=FALSE}
# Step: Calculate the weighted average percentage of ITN usage
weighted_average_ITN <- main %>%
  summarise(
    numerator = sum(sleep_ITN_HH * totalmembermosq, na.rm = TRUE),  # Weighted sum
    denominator = sum(totalmembermosq, na.rm = TRUE),  # Total population
    weighted_avg_sleep_ITN = (numerator / denominator) * 100  # Weighted average
  )

# Extract the weighted average
malaria_per <- weighted_average_ITN$weighted_avg_sleep_ITN

# Print the result
print(weighted_average_ITN)
cat("The weighted average % of people per household who slept under an ITN the previous night is:", malaria_per,"%\n")

```

```{r, eval=FALSE}
#ILGI: This is the start of the calculation at an individual level - % of people who slept under an ITN the previous night.
result <- main %>%
  summarise(
    total_ITN = sum(final_sleep_ITN, na.rm = TRUE),  # Total people who used ITN
    total_population = sum(totalmembermosq, na.rm = TRUE),  # Total population in malaria-endemic areas
    percentage_ITN = (total_ITN / total_population) * 100  # Calculate percentage
  )

# Print the final result
print(result)
cat("The percentage of population in malaria-endemic areas who slept under an ITN the previous night is:", result$percentage_ITN, "%\n")

```

##### Water, sanitation and hygiene
Percentage of population using at least basic sanitation services, that is, improved sanitation facilities that are not shared with other households. 

**Unit of observation**: Individual (based on household size)

**Numerator**:  Number of individuals with access to sanitation facility at their household

**Denominator**: Total number of individuals

**Dataset**: main

```{r, eval=FALSE}
table(main$SAN01) #What kind of toilet facility do members of your household use most of the time?
table(main$SAN02) #To the best of your knowledge, has this toilet ever been emptied?
table(main$SAN03) #The last time it was emptied, where were the contents emptied to?
table(main$SAN05) #Do you share this toilet facility with others who are not members of your household?
```
```{r, eval=FALSE}
#Step 1: Create a variable to check if the household uses an improved or unimproved sanitation facility 
main <- main %>%
  mutate(type_san_facility = case_when(
    SAN01 %in% c("11", "12", "13", "14", "18", "21", "22", "31") ~ 1,  # Improved sanitation facility
    SAN01 %in% c("23", "41", "51", "95", "96") ~ 0,  # Unimproved sanitation facility
    TRUE ~ NA_real_ 
    ))# Missing or invalid
```
```{r, eval=FALSE}
#Step 2: Create a variable to check if the contents of the toilet are safely disposed
main <- main %>%
 mutate(disposal_san_facility = case_when(
    SAN02 == 1 & SAN03 %in% c("5", "96", "98") ~ 0,  # Unsafe disposal
    SAN02 == 1 & SAN03 %in% c("1", "2", "3", "4") ~ 1,  # Safe disposal
    SAN02 == 2 ~ 0,  # Unsafe if no toilet
    SAN02 == 98 ~ 0,  # Unavailable information
    TRUE ~ NA_real_ )) # Missing or invalid
```
```{r, eval=FALSE}
#Step 3: Create a variable to check if the household shares the toilet facility with other households 
main <- main %>%
  mutate(shared_san_facility = case_when(
    SAN05 == 1 ~ 0,             # Shared toilet
    SAN05 == 2 ~ 1,             # Not shared
    SAN05 %in% c("98", "99") ~ NA # NA for 98 or 99
  ))

```
```{r, eval=FALSE}
#Step 4: Combine all three conditions
main <- main %>%
mutate(wash = case_when(
    type_san_facility == 1 & disposal_san_facility == 1 & shared_san_facility == 1 ~ 1,  # Basic sanitation service
    TRUE ~ 0  # If any condition fails
  ))

table(main$wash)
```
```{r, eval=FALSE}
# Step 5: Calculate weighted percentage
sanitation_percentage <- main %>%
  summarise(
    numerator = sum(wash * HHmembersize, na.rm = TRUE),  # Total individuals with access to basic sanitation
    denominator = sum(HHmembersize, na.rm = TRUE),  # Total population
    percentage_sanitation = (numerator / denominator) * 100  # Weighted percentage
  )

# Extract the final percentage
final_sanitation_per <- sanitation_percentage$percentage_sanitation

# Print the results
print(sanitation_percentage)
cat("The percentage of population using at least basic sanitation services is:", final_sanitation_per, "%\n")
```

##### Final calculation of the tracer - Access to Basic Health Care Services

```{r, eval=FALSE}
#Step 1: Calculate geometric mean of each of the two health care service areas
#Area 1: Reproductive, maternal, newborn and child health (RMNCH)
RMNCH <- (child_immun_per + antenatal_care_per)/2

#Area 2: Infectious diseases (ID)
ID <- (malaria_per + final_sanitation_per)/2
```
```{r, eval=FALSE}
#Step 2: Calculate the geometric mean of the two values to calculate the final UHC Service Coverage Index of the two health care service areas 
UHC <- (RMNCH + ID)/2
print(UHC)
```

### Final calculation of the SDG 1.4.1

This indicator is a combination of various components of basic services which on their own are mostly existing as standalone indicators of the SDGs. As a result, the team of experts advised and agreed that these should be presented as a dashboard. Their metadata provide the specific methodologies for computing each of the constituent measures used to report on this indicator.

## 1.4.2 SDG Indicator

**Proportion of total adult population with secure tenure rights to land, (a) with legally recognized documentation, and (b) who perceive their rights to land as secure, by sex and type of tenure**

Indicator Code: C010402

Indicator 1.4.2 measures the relevant part of Target 1.4 (ensure men and women have equal rights to economic resources, as well as access to …, ownership of and control over land and other forms of property, inheritance, natural resources). It measures the results of policies that aim to strengthen tenure security for all, including women and other vulnerable groups.


Indicator 1.4.2 covers (a) all types of land use (such as residential, commercial, agricultural, forestry, grazing, wetlands based on standard land-use classification) in both rural and urban areas; and (b) all land tenure types as recognized at the country level, such as freehold, leasehold, public land, customary land. An individual can hold land in his/her own name, jointly with other individuals, as a member of a household, or collectively as member of group1, cooperative or other type of association.

**Secure tenure rights:** comprised of two sub-components: (i) legally recognized documentation and (ii) perception of the security of tenure, which are both necessary to provide a full measurement of tenure security.


**Legally recognized documentation:** Legal documentation of rights refers to the recording and publication of information on the nature and location of land, rights and right holders in a form that is recognized by government, and is therefore official. For purposes of computing SDG Indicator 1.4.2, the country specific metadata will define what documentation on land rights will be counted as legally recognized.


**Perceived security of tenure:** Perception of tenure security refers to an individual’s perception of the likelihood of involuntary loss of land, such as disagreement of the ownership rights over land or ability to use it, regardless of the formal status and can be more optimistic or pessimistic. Although those without land rights’ documentation may frequently be perceived to be under threat, and those with documentation perceived as protected, there may be situations where documented land rights alone are insufficient to guarantee tenure security. Conversely, even without legally recognized documentation, individuals may feel themselves to be protected against eviction or dispossession. Therefore, capturing and analysing these diverse ranges of situations will enable a more comprehensive understanding of land tenure security, based on a country specific context.


For purposes of constructing the indicator (see next section for rationale), we define perceptions of tenure to be secure if:

(i) The landholder does not report a fear of involuntary loss of the land within the next five years due to, for example, intra-family, community or external threats and

(ii) The landholder reports having the right to bequeath the land.


| Standard Questions    |
|:---------------------:|
| Land10, Land14, Land15|

**Unit of observation**: Individual

**Dataset**: RA_caregiver

1. SDG 1.4.2 a

**Unit of observation**: Individual (based on household size)

**Numerator**:  People (adults) with legally recognized documentation over land

**Denominator**: Total adult population

**Dataset**: main

2. SDG 1.4.2 b

**Unit of observation**: Individual (based on household size)

**Numerator**:  People (adults) who perceive their rights as secure

**Denominator**: Total adult population

**Dataset**: main

**Sources**  
1.[SDG 1.4.2 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-01-04-02.docx&wdOrigin=BROWSELINK)

ILGI: Guidance does not mention how to compute the indicator when various plots are involved. Therefore, I have looked at if at least for one plot, the household has legal documents, can bequeath the plot, and is unlikely to loose it. Additionally, this is an individual level indicator and we do have individual data on documentation, however we do not have individual info for security of tenure and bequeath (we do but only from HOH not all members). Moreover, for documents, if counts that someone has a document even if he/she has it as a member of a household. Therefore I looked at the data from a perspective of a household, not individual household members. 


```{r, eval=FALSE}
#table(main$Land10) #Does your household have a document for [current plot] from any government Agency, which formally recognizes the use rights/ownership rights?
#table(main$Land14) #Does anyone in the household have the right to bequeath [current plot], either alone or jointly with someone else?
#table(main$Land15) # How likely is it that someone would take [current plot] from your household in the next 5 years? Very unlikely, somewhat unlikely, somewhat likely, or very likely?
```

```{r, eval=FALSE}
#Step 1: Questions on land are asked for each plot the household might own or use. Therefore we first need to check all coloumns and create new variables which will assign 1 based on specific conditions: 
main <- main %>%
  mutate(
    # Land10: Assign 1 if the household has a legal document for at least one plot
    documents = ifelse(rowSums(across(starts_with("Land10"), ~ .x == 1), na.rm = TRUE) > 0, 1, 0),
    
    # Land14: Assign 1 if the household can bequeath at least one plot
    bequeath = ifelse(rowSums(across(starts_with("Land14"), ~ .x == 1), na.rm = TRUE) > 0, 1, 0),
    
    # Land15: Assign 1 if the loss of tenure is very unlikely or somewhat unlikely for at least one plot
    tenure = ifelse(rowSums(across(starts_with("Land15"),  ~ .x %in% c(1, 2)), na.rm = TRUE) > 0, 1, 0)
  )
```

```{r, eval=FALSE}
#Step 2: SDG 1.4.2 a -  People (adults) with legally recognized documentation over land
main <- main %>%
mutate(C010402a = case_when(documents == 1~ 1,  #Assigns 1 if the household has a legal document for at least one plot
    TRUE ~ 0))
```
```{r, eval=FALSE}
table(main$legal_doc)
```
```{r, eval=FALSE}
main <- main %>%
   mutate(C010402a = labelled(C010402a,
                                labels = c(
                                  "Has Legal document" = 1,  # Label for Yes
                                  "No legal documents" = 0   # Label for No
                                ),
                                label = "People (adults) with legally recognized documentation over land"))
```

```{r, eval=FALSE}
#Step 2: 2. SDG 1.4.2 b - People (adults) who perceive their rights as secure
main <- main %>%
mutate(C010402b = case_when(bequeath == 1 & tenure == 1 ~ 1,  #Assigns 1 if the household can bequeath at least one plot and is very unlikely or somewhat unlikely to loose the tenure of at least one plot 
    TRUE ~ 0))
```
```{r, eval=FALSE}
table(main$tenure)
```
```{r, eval=FALSE}
main <- main %>%
   mutate(C010402b = labelled(C010402b,
                                labels = c(
                                  "Tenure secure" = 1,  # Label for Yes
                                  "Tenure unsecure" = 0   # Label for No
                                ),
                                label = "People (adults) who perceive their rights as secure"))
```
ILGI: Is household size as weight incorporated into the total weight which will be created by Grayson? 

### Figure for SDG 1.4.2a by Population Groups

```{r, eval=FALSE}

##Table by population groups

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C010402a <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG 1.4.1a",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C010402a, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of SDH 1.4.2 a by pop groups

ggplot(C010402a, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 1.4.2a",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```
### Figure for SDG 1.4.2b by Population Groups

```{r, eval=FALSE}

##Table by population groups

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C010402b <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG 1.4.1b",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C010402b, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of SDG 1.4.2b by pop groups

ggplot(C010402b, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 1.4.2b",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```
## 2.2.1 SDG Indicator

**Prevalence of stunting (height for age <-2 standard deviation from the median of the World Health Organization (WHO) Child Growth Standards) among children under 5 years of age**

Indicator Code: C020201

Prevalence of stunting (height-for-age <-2 standard deviation from the median of the World Health Organization (WHO) Child Growth Standards) among children under 5 years of age.

Child growth is an internationally accepted outcome reflecting child nutritional status. Child stunting refers to a child who is too short for his or her age and is the result of chronic or recurrent malnutrition. Stunting is a contributing risk factor to child mortality and is also a marker of inequalities in human development. Stunted children fail to reach their physical and cognitive potential. Child stunting is one of the World Health Assembly nutrition target indicators.

For the calculation of this indicator we will use the [anthro](https://cran.r-project.org/web/packages/anthro/anthro.pdf) package which provides WHO Child Growth Standards (z-scores) with confidence intervals and standard errors around the prevalence estimates, taking into account complex sample designs.The output needed for the calculation of this indicator is: "zlen" Length/Height-for-age z-score

| Standard Questions    |
|:---------------------:|
|    AN7,AN8            |

**Unit of observation**: Individual

**Dataset**: RA_caregiver

**Sources**  
1.[SDG 2.2.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-02-02-01.docx&wdOrigin=BROWSELINK)
2.[UNICEF - Anthropometric indicators in children under 5 years old](https://data.unicef.org/resources/data-collection-analysis-reporting-on-anthropometric-indicators-in-children-under-5/)
3.[Child growth standard](https://www.who.int/tools/child-growth-standards)
4.[Anthro package github](https://github.com/worldhealthorganization/anthro)

```{r, eval=FALSE}
#Step 1: Install and load the anthro package - This is the package needed for facilitating the calculations 
install.packages("anthro")
remotes::install_github("worldhealthorganization/anthro")
library(anthro)
```

```{r, eval=FALSE}
#Step 2: Calculate z-scores
RA_caregiver <- RA_caregiver %>%
  bind_cols(
with(
  RA_caregiver,
  anthro_zscores(
    sex = childnametouseSEX, # Column indicating child sex
    age = childnametouseAGE, # Column indicating child age
    weight = AN6,  # Column indicating weight measurement
    lenhei = AN7,  # Column indicating height/length measurement
    measure = AN8, # Column indicating measurement type
    is_age_in_month = TRUE      # Specify that age is in months
  )
))

```
```{r, eval=FALSE}
#Step 3: Calculate the indicator: 
RA_caregiver <- RA_caregiver %>%
  mutate(
    C020201 = case_when(
      zlen < -2 ~ 1, 
      zlen > -2 ~ 0,
      TRUE ~ NA_real_  ))
```
```{r, eval=FALSE}
stunting_prevalence <- RA_caregiver %>%
  summarize(prevalence = mean(C020201, na.rm = TRUE) * 100)

cat("Prevalence of stunting: ", stunting_prevalence$prevalence, "%\n")
```

```{r, eval=FALSE}

##This indicator is located in the 'RA_caregiver' dataset

##Add weights when/if available
FDS_PAK_2024_RA_caregiver <- RA_caregiver %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = , # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )
```

###Figure for SDG 2.2.1 

```{r, eval=FALSE}
#Table by population groups 
#This table is done as an example on the FDS PAK dataset. Ensure to re-name your table if you are working on a different dataset.

####Standard tables 


SDG_2_2_1 <- RA_caregiver %>%
  select(Intro_07, childnametouseSEX, C020201) %>%
  group_by(Intro_07, childnametouseSEX) %>%
  summarise(prevalence = mean(C020201, na.rm = TRUE) * 100) %>%
  ungroup()
```
```{r}
SDG_2_2_1 <- SDG_2_2_1 %>%
  mutate(
    sex_label = dplyr::recode(
      childnametouseSEX,
      "M" = "Male",
      "F" = "Female"
    )
  )

```
```{r}
SDG_2_2_1 %>%
  ggplot(aes(x = sex_label, y = prevalence, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(
    aes(label = round(prevalence, 1)),
    position = position_dodge(width = 0.9),
    vjust = -0.5,
    size = 3
  ) +
  scale_fill_unhcr_d() +
  scale_y_continuous(limits = c(0, 110), expand = c(0, 0)) +
  labs(
    title = "Prevalence of Stunting by Sex and Population Group",
    x = "Sex of Child",
    y = "Stunting Prevalence (%)",
    fill = "Population Groups"
  ) +
  theme_unhcr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
```{r}
### Figure for SDG 2.2.1 by Population Groups 

##Indicator Results 

# Table by population groups
C020201 <- FDS_PAK_2024_RA_caregiver %>%    
  filter(!is.na(Intro_07)) %>%    # Exclude if population groups is NA
  group_by(Intro_07) %>%          # Group by population groups
  summarise(                      # Summarise the variables
    var_name = "stunting_prevalence",        # Name of the variable
    num_obs_uw = unweighted(n()), # Unweighted total count
    denominator = survey_total(), # Weighted total count
    mean_value = survey_mean(C020201, vartype = c("ci", "se"), na.rm = TRUE) # Weighted mean with CI and SE
  ) 

# Chart for RBM10202 by population groups
ggplot(C020201, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value_low, ymax = mean_value_upp),  # Confidence intervals
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Prevalence of Stunting by Population Groups",
    x = "Population Groups",
    y = "Weighted Prevalence with Standard Errors"
  ) +
  scale_fill_unhcr_d() + 
  theme_unhcr() +         # Apply UNHCR theme 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```



## 2.2.2 SDG Indicator 

**Prevalence of malnutrition (weight for height >+2 or <-2 standard deviation from the median of the WHO Child Growth Standards) among children under 5 years of age, by type (wasting and overweight)**

Indicator Code: C020202

In the context of FDS, which is 


Child growth is an internationally accepted outcome reflecting child nutritional status. 

Child wasting refers to a child who is too thin for his or her height and is the result of recent rapid weight loss or the failure to gain weight. A child who is moderately or severely wasted has an increased risk of death, but treatment is possible.

Child overweight refers to a child who is too heavy for his or her height. This form of malnutrition results from expending too few calories for the amount of food consumed and increases the risk of noncommunicable diseases later in life.

For the calculation of this indicator we will use the [anthro](https://cran.r-project.org/web/packages/anthro/anthro.pdf) package which provides WHO Child Growth Standards (z-scores) with confidence intervals and standard errors around the prevalence estimates, taking into account complex sample designs.The output needed for the calculation of this indicator is: "zwfl" weight-for-length/height z-score

| Standard Questions             |
|:------------------------------:|
|    AN6, AN7, AN8               |

**Unit of observation**: Individual

**Dataset**: RA_caregiver

**Sources**  
1.[SDG 2.2.2b Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-02-02-02b.docx&wdOrigin=BROWSELINK)
2.[SDG 2.2.2a Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-02-02-02a.docx&wdOrigin=BROWSELINK)
3.[UNICEF - Anthropometric indicators in children under 5 years old](https://data.unicef.org/resources/data-collection-analysis-reporting-on-anthropometric-indicators-in-children-under-5/)
4.[Child growth standard](https://www.who.int/tools/child-growth-standards)
5.[Anthro package github](https://github.com/worldhealthorganization/anthro)

```{r, eval=FALSE}
#Step 1: Install and load the anthro package - This is the package needed for facilitating the calculations 
install.packages("anthro")
remotes::install_github("worldhealthorganization/anthro")
library(anthro)
```

```{r, eval=FALSE}
#Step 2: Calculate z-scores
RA_caregiver <- RA_caregiver %>%
  bind_cols(
with(
  RA_caregiver,
  anthro_zscores(
    sex = childnametouseSEX, # Column indicating child sex
    age = childnametouseAGE, # Column indicating child age
    weight = AN6,  # Column indicating weight measurement
    lenhei = AN7,  # Column indicating height/length measurement
    measure = AN8, # Column indicating measurement type
    is_age_in_month = TRUE      # Specify that age is in months
  )
))

```
```{r, eval=FALSE}
#Step 3: Calculate the tracer for wasting: 
RA_caregiver <- RA_caregiver %>%
  mutate(
    C020202b = case_when(
      zwfl < -2 ~ 1, 
      zwfl > -2 ~ 0,
      TRUE ~ NA_real_  ))
      
```
```{r, eval=FALSE}
wasting_prevalence <- RA_caregiver %>%
  summarize(prevalence = mean(C020202b, na.rm = TRUE) * 100)

cat("Prevalence of wasting: ", wasting_prevalence$prevalence, "%\n")
```
```{r, eval=FALSE}
#Step 4: Calculate the tracer for overweight: 
RA_caregiver <- RA_caregiver %>%
  mutate(
    C020202a = case_when(
      zwfl > 2 ~ 1, 
      zwfl < 2 ~ 0,
      TRUE ~ NA_real_  ))
      
```
```{r, eval=FALSE}
overweight_prevalence <- RA_caregiver %>%
  summarize(prevalence = mean(C020202a, na.rm = TRUE) * 100)

cat("Prevalence of overweight: ", overweight_prevalence$prevalence, "%\n")
```

```{r, eval=FALSE}

##This indicator is located in the 'RA_caregiver' dataset

##Add weights when/if available
FDS_PAK_2024_RA_caregiver <- RA_caregiver %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = , # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )
```

###Figure for SDG 2.2.2b 

```{r, eval=FALSE}
#Table by population groups 
#This table is done as an example on the FDS PAK dataset. Ensure to re-name your table if you are working on a different dataset.

####Standard tables 


SDG_2_2_2b <- RA_caregiver %>%
  select(Intro_07, childnametouseSEX, C020202b) %>%
  group_by(Intro_07, childnametouseSEX) %>%
  summarise(prevalence = mean(C020202b, na.rm = TRUE) * 100) %>%
  ungroup()
```
```{r}

SDG_2_2_2b <- SDG_2_2_2b %>%
  mutate(
    sex_label = dplyr::recode(
      childnametouseSEX,
      "M" = "Male",
      "F" = "Female"
    )
  )
```
```{r}
SDG_2_2_2b %>%
  ggplot(aes(x = sex_label, y = prevalence, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(
    aes(label = round(prevalence, 1)),
    position = position_dodge(width = 0.9),
    vjust = -0.5,
    size = 3
  ) +
  scale_fill_unhcr_d() +
  scale_y_continuous(limits = c(0, 110), expand = c(0, 0)) +
  labs(
    title = "Prevalence of wasting by Sex and Population Group",
    x = "Sex of Child",
    y = "Wasting Prevalence (%)",
    fill = "Population Groups"
  ) +
  theme_unhcr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
```{r}
### Figure for SDG 2.2.2b by Population Groups 

##Indicator Results 

# Table by population groups
C020202b <- FDS_PAK_2024_RA_caregiver %>%    
  filter(!is.na(Intro_07)) %>%    # Exclude if population groups is NA
  group_by(Intro_07) %>%          # Group by population groups
  summarise(                      # Summarise the variables
    var_name = "wasting_prevalence",        # Name of the variable
    num_obs_uw = unweighted(n()), # Unweighted total count
    denominator = survey_total(), # Weighted total count
    mean_value = survey_mean(C020202b, vartype = c("ci", "se"), na.rm = TRUE) # Weighted mean with CI and SE
  ) 

# Chart for RBM10202 by population groups
ggplot(C020202b, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value_low, ymax = mean_value_upp),  # Confidence intervals
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Prevalence of Wasting by Population Groups",
    x = "Population Groups",
    y = "Weighted Prevalence with Standard Errors"
  ) +
  scale_fill_unhcr_d() + 
  theme_unhcr() +         # Apply UNHCR theme 
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

## 3.1.2 SDG Indicator 

**Proportion of births attended by skilled health personnel**

Indicator Code: C030102

Proportion of births attended by skilled health personnel (generally doctors, nurses or midwives but can refer to other health professionals providing childbirth care) is the proportion of childbirths attended by skilled health personnel. According to the current definition these are competent maternal and newborn health (MNH) professionals educated, trained and regulated to national and international standards. They are competent to: (i) provide and promote evidence-based, human-rights based, quality, socio-culturally sensitive and dignified care to women and newborns; (ii) facilitate physiological processes during labour and delivery to ensure a clean and positive childbirth experience; and (iii) identify and manage or refer women and/or newborns with complications.


| Standard Questions |
|:------------------:|
|    BA10            |

**Unit of observation**: Individual

**Numerator**: Number of women aged 15-49 with a live birth attended by a skilled health personnel (e.g., doctors, nurses or midwives)

**Denominator**: Total number of women aged 15-49 with a live birth in the same period

**Dataset**: RA_woman

**Sources**  
1.[SDG 3.1.2 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-03-01-02.docx&wdOrigin=BROWSELINK)

```{r, eval=FALSE}
table(RA_woman$BA10) #Who assisted you with the delivery?

```
```{r, eval=FALSE}
RA_woman <- RA_woman %>%
  mutate(
    C030102 = case_when(
      BA10 %in% c("A", "B", "C") ~ 1,           # Assign 1 for skilled personnel
      BA10 %in% c("D", "E", "F") ~ 0,           # Assign 0 for unskilled personnel
      BA10 == "X" ~ NA_real_,                   # Set NA for X(Other, specify)
      TRUE ~ NA_real_                           # Set NA for any other values not specified
    )
  )


RA_woman <- RA_woman %>%
mutate(C030102 = labelled(C030102,
                                labels = c(
                                  "Yes" = 1,  # Yes for skilled personnel
                                  "No" = 0    # No for unskilled personnel
                                ),
                                label = "Proportion of births attended by skilled health personnel"
  ))
```
### Figure for SDG 3.1.2 by Population Groups
```{r, eval=FALSE}

##This indicator is located in the 'RA_woman' dataset

##Add weights when/if available
FDS_PAK_2024_RA_woman <- RA_woman %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = , # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )
C030102 <- FDS_PAK_2024_RA_woman %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG3_1_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C030102, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above



ggplot(C030102, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 3.1.2",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

Note* This indicator should not be dissagregated by disability 

## 3.8.1 SDG Indicator

**Coverage of essential health services**

Indicator Code: C030801

Coverage of essential health services (defined as the average coverage of essential services based on tracer interventions that include reproductive, maternal, newborn and child health, infectious diseases, non-communicable diseases and service capacity and access, among the general and the most disadvantaged population).

Concepts:

The index of health service coverage is computed as the geometric means of 14 tracer indicators and expressed as a UHC Service Coverage Index. 4 health service areas, and 14 tracer indicators are the following:

I. Reproductive, maternal, newborn and child health (family planning,pregnancy care,child immunization, child treatment)
II. Infectious disease (tuberculosis, HIV/AIDS, Malaria, WASH)
III. Noncommunicable diseases (Hypertension, diabetes, tobacco)
IV. Service capacity and access (hospital access, health workers, health security)

In FDS, we are able to evaluate two health service areas, area I. and II. through 4 tracer indicators - on pregnancy care, child immunization, malaria, WASH. Therefore the final indicator calculation results in a proxy for SDG 3.8.1 

| Tracers            | Variables                                                            |
|--------------------|:--------------------------------------------------------:            |
| Pregnancy care     |BA4, BA6_1                                                            |                                                    
| child immunization |MV7, MV8                                                              |
| Malaria            |MN05_2, MN05_3, HH_13                                                 |
| WASH               |SAN01, SAN02, SAN03, SAN05                                            |


**Sources**  
1.[SDG 3.8.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-03-08-01.docx&wdOrigin=BROWSELINK)

### Calculate variables for tracer indicators {.tabset}

#### Pregnancy care

Percentage of women aged 15-49 years with a live birth in a given time period who received antenatal care four or more times.

**Unit of observation**: Individual

**Numerator**: Number of women aged 15−49 years with a live birth in a given time period who received antenatal care four or more times

**Denominator**: Total number of women aged 15−49 years with a live birth in the same period (last 2 years in FDS)

**Dataset**: RA_woman


```{r, eval=FALSE}
table(RA_woman$BA4) #Did you see anyone for a follow-up visit during your last pregnancy?
table(RA_woman$BA6_1) #Overall during your pregnancy, how many times did you have a follow-up visit with a health professional?
```

```{r, eval=FALSE}
#Step 1: Create a variable assessing if women aged 15−49 years with a live birth in the last 2 years received antenatal care four or more times
RA_woman <- RA_woman %>%
  mutate(
    pregnancy_care = case_when(
      BA4 == 1 & BA6_1 >= 4 ~ 1,           # Assign 1 when antenatal care was received 4 or more times
      BA4 == 2 ~ 0,                        # Assign 0 when no antenatal care was received
      BA4 == 1 & BA6_1 < 4 ~ 0))           # Assign 0 when antenatal care was received less than 4 times
      
```
```{r, eval=FALSE}
#Step 2: Calculate the percentage of women aged 15−49 years with a live birth in the last 2 years who received antenatal care four or more times
antenatal_care_per <- RA_woman %>%
  filter(!is.na(pregnancy_care)) %>%  # Exclude rows with NA in pregnancy_care
  summarise(
    total_women = n(),  # Total number of women in the denominator
    received_anc4_count = sum(pregnancy_care, na.rm = TRUE),  # Count of women in the numerator
    percentage = (received_anc4_count / total_women) * 100  # Percentage calculation
  ) %>%
  pull(percentage)

# Print the result
cat("The percentage of women aged 15−49 years with a live birth in the last 2 years who received antenatal care four or more times is:", antenatal_care_per, "%\n")
```

#### Child immunization

Percentage of infants receiving three doses of diphtheria-tetanus-pertussis containing vaccine

**Unit of observation**: Individual

**Numerator**: Children 1 year of age who have received three doses of diphtheria-tetanus-pertussis containing vaccine

**Denominator**: All children 1 year of age

**Dataset**: RA_caregiver

```{r, eval=FALSE}
table(RA_caregier$MV7)  #Has the child received Pentavalent vaccine (DPT + Hep B + Hib) that is, three shots in the arm by the age of 14 weeks - to prevent from getting Diphtheriae, Pertussis, Tetanus, Hepatitis B and Haemophilus Influenza type B - HIB)
table(RA_caregiver$MV8) #How many times did the child receive the Pentavalent vaccine?
summary(RA_caregiver$child_age_immunization) #Age of the child 
```

```{r, eval=FALSE}
#Step 1: Create a variable assessing if the children 1 year of age have received three shots of pentavalent vaccine
RA_caregiver <- RA_caregiver %>%
  mutate(
    child_immunization = case_when(
      (child_age_immunization >= 12 & child_age_immunization <= 23) & MV7 %in% c(1, 2) & MV8 >= 3 & MV8 != 98 ~ 1, # 1 for yes
      (child_age_immunization >= 12 & child_age_immunization <= 23) & MV7 == 3 ~ 0,  # 0 for No
      TRUE ~ NA_real_  # Assign NA for MV7 == 98 or any other conditions
    )
  )           
      
```
```{r, eval=FALSE}
#Step 2: Calculate the percentage of infants receiving three doses of diphtheria-tetanus-pertussis containing vaccine

child_immun_per <- RA_caregiver %>%
  filter(!is.na(child_immunization)) %>%  # Exclude rows with NA in child_immunization
  summarise(
    child_immun_per = (sum(child_immunization, na.rm = TRUE) / n()) * 100  # Calculate the percentage
  ) %>%
  pull(child_immun_per)

cat("The percentage of children receiving three doses of the DTP-containing vaccine is:", child_immun_per, "%\n")

```
#### Malaria prevention

Percentage of population in malaria-endemic areas who slept under an ITN the previous night.

**Unit of observation**: Individual (based on household size)

**Numerator**: Number of people in malaria-endemic areas who slept under an ITN

**Denominator**: Total number of people in malaria endemic areas.

**Dataset**: main

```{r, eval=FALSE}
table(main$MN05_2) #You told me that X people slept under [bednets/mosquito nets] last night, how many of them slept under treated [bednets/mosquito nets]?
table(main$MN05_3) #You told me that one person slept under [bednets/mosquito nets] last night, did this person sleep under treated [bednets/mosquito nets]?
table(main$HH_13)  #Did you sleep here last  night? 
```


```{r, eval=FALSE}
#Step 1: Create a composite variable to capture the number of people that slept under ITN in the household, the previous night.
main <- main %>%
  mutate(
    final_sleep_ITN = case_when(
      !is.na(MN05_2) ~ MN05_2,  # Take MN05_2 if it is not empty
      is.na(MN05_2) & !is.na(MN05_3) ~ MN05_3,  # Take MN05_3 if MN05_2 is empty but MN05_3 is not
      is.na(MN05_2) & is.na(MN05_3) ~ NA_real_  # Assign NA if both are empty
    )
  )
```

```{r, eval=FALSE}
#Step 2: Calculate the total number of household members who slept it the household the night before 
HHroster <- HHroster %>%
mutate(
    sleep_HH = case_when(
      member == 1 & HH_13 == 1 ~ 1, 
      TRUE ~ NA_real_))

mosquito_members <- HHroster %>%
  group_by(uuid) %>%
  summarise(
    totalmembermosq = if (all(is.na(sleep_HH))) NA_real_ else sum(sleep_HH == 1, na.rm = TRUE)
  )

# Join with the main data set
main <- main %>%
  left_join(mosquito_members, by = "uuid")
```

```{r, eval=FALSE}
#ILGI: This is the start of the calculation at a household level - % of people in each household that slept under an ITN the night before. 
#Step 3: Calculate the % of people that slept under mosquito nets in each household 
main <- main %>%
  mutate(
    sleep_ITN_HH = case_when(
      !is.na(final_sleep_ITN) & !is.na(totalmembermosq) ~ final_sleep_ITN/totalmembermosq,  
      is.na(final_sleep_ITN) | is.na(totalmembermosq) ~ NA_real_))  # NA if nominator or denominator are NA
 

```
```{r, eval=FALSE}
# Calculate the average percentage, ignoring NAs
average_sleep_ITN <- main %>%
  summarise(
    avg_sleep_ITN_HH = mean(sleep_ITN_HH, na.rm = TRUE)
  )

avg_value <- (average_sleep_ITN$avg_sleep_ITN_HH)*100

# Print the result
print(average_sleep_ITN)
cat("The average % of people per household who slept under ITN the previous night is:", avg_value, "%\n")

```
```{r, eval=FALSE}
# Step: Calculate the weighted average percentage of ITN usage
weighted_average_ITN <- main %>%
  summarise(
    numerator = sum(sleep_ITN_HH * totalmembermosq, na.rm = TRUE),  # Weighted sum
    denominator = sum(totalmembermosq, na.rm = TRUE),  # Total population
    weighted_avg_sleep_ITN = (numerator / denominator) * 100  # Weighted average
  )

# Extract the weighted average
malaria_per <- weighted_average_ITN$weighted_avg_sleep_ITN

# Print the result
print(weighted_average_ITN)
cat("The weighted average % of people per household who slept under an ITN the previous night is:", malaria_per,"%\n")

```

```{r, eval=FALSE}
#ILGI: This is the start of the calculation at an individual level - % of people who slept under an ITN the previous night.
result <- main %>%
  summarise(
    total_ITN = sum(final_sleep_ITN, na.rm = TRUE),  # Total people who used ITN
    total_population = sum(totalmembermosq, na.rm = TRUE),  # Total population in malaria-endemic areas
    percentage_ITN = (total_ITN / total_population) * 100  # Calculate percentage
  )

# Print the final result
print(result)
cat("The percentage of population in malaria-endemic areas who slept under an ITN the previous night is:", result$percentage_ITN, "%\n")

```

#### Water, sanitation and hygiene
Percentage of population using at least basic sanitation services, that is, improved sanitation facilities that are not shared with other households. 

**Unit of observation**: Individual (based on household size)

**Numerator**:  Number of individuals with access to sanitation facility at their household

**Denominator**: Total number of individuals

**Dataset**: main

```{r, eval=FALSE}
table(main$SAN01) #What kind of toilet facility do members of your household use most of the time?
table(main$SAN02) #To the best of your knowledge, has this toilet ever been emptied?
table(main$SAN03) #The last time it was emptied, where were the contents emptied to?
table(main$SAN05) #Do you share this toilet facility with others who are not members of your household?
```
```{r, eval=FALSE}
#Step 1: Create a variable to check if the household uses an improved or unimproved sanitation facility 
main <- main %>%
  mutate(type_san_facility = case_when(
    SAN01 %in% c("11", "12", "13", "14", "18", "21", "22", "31") ~ 1,  # Improved sanitation facility
    SAN01 %in% c("23", "41", "51", "95", "96") ~ 0,  # Unimproved sanitation facility
    TRUE ~ NA_real_ 
    ))# Missing or invalid
```
```{r, eval=FALSE}
#Step 2: Create a variable to check if the contents of the toilet are safely disposed
main <- main %>%
 mutate(disposal_san_facility = case_when(
    SAN02 == 1 & SAN03 %in% c("5", "96", "98") ~ 0,  # Unsafe disposal
    SAN02 == 1 & SAN03 %in% c("1", "2", "3", "4") ~ 1,  # Safe disposal
    SAN02 == 2 ~ 0,  # Unsafe if no toilet
    SAN02 == 98 ~ 0,  # Unavailable information
    TRUE ~ NA_real_ )) # Missing or invalid
```
```{r, eval=FALSE}
#Step 3: Create a variable to check if the household shares the toilet facility with other households 
main <- main %>%
  mutate(shared_san_facility = case_when(
    SAN05 == 1 ~ 0,             # Shared toilet
    SAN05 == 2 ~ 1,             # Not shared
    SAN05 %in% c("98", "99") ~ NA # NA for 98 or 99
  ))

```
```{r, eval=FALSE}
#Step 4: Combine all three conditions
main <- main %>%
mutate(wash = case_when(
    type_san_facility == 1 & disposal_san_facility == 1 & shared_san_facility == 1 ~ 1,  # Basic sanitation service
    TRUE ~ 0  # If any condition fails
  ))

table(main$wash)
```
```{r, eval=FALSE}
# Step 5: Calculate weighted percentage
sanitation_percentage <- main %>%
  summarise(
    numerator = sum(wash * HHmembersize, na.rm = TRUE),  # Total individuals with access to basic sanitation
    denominator = sum(HHmembersize, na.rm = TRUE),  # Total population
    percentage_sanitation = (numerator / denominator) * 100  # Weighted percentage
  )

# Extract the final percentage
final_sanitation_per <- sanitation_percentage$percentage_sanitation

# Print the results
print(sanitation_percentage)
cat("The percentage of population using at least basic sanitation services is:", final_sanitation_per, "%\n")
```

### Final calculation of the SDG 3.8.1 

```{r, eval=FALSE}
#Step 1: Calculate geometric mean of each of the two health care service areas
#Area 1: Reproductive, maternal, newborn and child health (RMNCH)
RMNCH <- (child_immun_per + antenatal_care_per)/2

#Area 2: Infectious diseases (ID)
ID <- (malaria_per + final_sanitation_per)/2
```
```{r, eval=FALSE}
#Step 2: Calculate the geometric mean of the two values to calculate the final UHC Service Coverage Index of the two health care service areas 
UHC <- (RMNCH + ID)/2
print(UHC)
```

## 4.1.2 SDG Indicator

**Completion rate (primary education, lower secondary education, upper secondary education)**

Indicator Code: C040102

Percentage of a cohort of children or young people aged 3-5 years above the intended age for the last grade of each level of education who have completed that grade.

The intended age for the last grade of each level of education is the age at which pupils would enter the grade if they had started school at the official primary entrance age, had studied full-time and had progressed without repeating or skipping a grade.For example, if the official age of entry into primary education is 6 years, and if primary education has 6 grades, the intended age for the last grade of primary education is 11 years. In this case, 14-16 years (11 + 3 = 14 and 11 + 5 = 16) would be the reference age group for calculation of the primary completion rate.

| Standard Questions                                     |
|:------------------------------------------------------:|
|    HH_Educ02a, HH_Educ03, HH_Educ17, HH_Educ18         |

**Unit of observation**: Individual 

**Numerator**:  population aged 3 to 5 years above the official entrance age a into the last grade of level n of education who completed level n

**Denominator**:  population aged 3 to 5 years above the official entrance age a into the last grade of level n of education

**Dataset**: HHroster

**Note:** Prior to running the below calculation, ensure to check the ISCED education levels for the country where the survey has taken place, The below example is done on the FDS Pakistan survey, therefore the education levels and the official entrance age is adjusted to Pakistan. 

**Sources**  
1.[SDG 4.1.2 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-04-01-02.docx&wdOrigin=BROWSELINK)
2.[ISCED Diagrams](https://isced.uis.unesco.org/visualizations/)


```{r, eval=FALSE}
summary(HHroster$agetouse) # Age of the individual
table(HHroster$HH_Educ02a) # Are you currently going to school?  If it is school holiday between two school years, tell us about the last school year.Do not include kindergarten or preschool.
table(HHroster$HH_Educ03)  #What [grade / year] are you/is he/she attending?
table(HHroster$HH_Educ17)  # In which country have you/has she/he completed your/theirs highest level of formal education?
table(HHroster$HH_Educ18)  # What is the highest [grade / year] of formal education that you/he/she has/have completed?
table(HHroster$primary_complete) #If an individual has completed primary school
table(HHroster$lowersec_complete) #If an individual has completed lower secondary school
table(HHroster$uppersec_complete) #If an individual has completed upper secondary school
```
1. Calculation for the SDG 4.1.2 - following the age cut off - 3 to 5 years above the official entrance age a into the last grade of level n
```{r, eval=FALSE}
#Primary education
HHroster <- HHroster %>%
mutate(C040102_primary = case_when(
  agetouse %in% 12:14 & primary_complete == 1 ~ 1, #Primary school complete
  agetouse %in% 12:14 & is.na(primary_complete) ~ 0, #Primary school not complete
  TRUE ~ NA_real_)) 
```

```{r, eval=FALSE}
#Lower secondary education
HHroster <- HHroster %>%
mutate(C040102_lowersec = case_when(
  agetouse %in% 15:17 & lowersec_complete == 1 ~ 1, #Lower secondary school complete
  agetouse %in% 15:17 & is.na(lowersec_complete) ~ 0, #Lower secondary not complete
  TRUE ~ NA_real_)) 
```

```{r, eval=FALSE}
#Upper secondary complete
HHroster <- HHroster %>%
mutate(C040102_uppersec = case_when(
  agetouse %in% 19:21 & uppersec_complete == 1 ~ 1, #Upper secondary complete
  agetouse %in% 19:21 & is.na(uppersec_complete) ~ 0, #Upper secondary not complete
  TRUE ~ NA_real_)) 
```

```{r, eval=FALSE}
table(HHroster$C040102_primary)
table(HHroster$C040102_lowersec)
table(HHroster$C040102_uppersec)
```

2. 1. Alternative approach to calculation for the SDG 4.1.2 - open age, upper limit of 34 based on 
[Expert Group on Refugee and Internally Displaced Persons Statistics — International Recommendations on Refugee Statistics](https://egrisstats.org/wp-content/uploads/2021/12/International-Recommendations-on-Refugee-Statistics.pdf). Note that this approach does not directly correspond to the SDG indicator calculation. 
```{r, eval=FALSE}
#Primary education
HHroster <- HHroster %>%
mutate(C040102_primary_open = case_when(
  agetouse %in% 12:34 & primary_complete == 1 ~ 1, #Primary school complete
  agetouse %in% 12:34 & is.na(primary_complete) ~ 0, #Primary school not complete
  TRUE ~ NA_real_)) 
```

```{r, eval=FALSE}
#Lower secondary education
HHroster <- HHroster %>%
mutate(C040102_lowersec_open = case_when(
  agetouse %in% 15:34 & lowersec_complete == 1 ~ 1, #Lower secondary school complete
  agetouse %in% 15:34 & is.na(lowersec_complete) ~ 0, #Lower secondary not complete
  TRUE ~ NA_real_)) 
```

```{r, eval=FALSE}
#Upper secondary complete
HHroster <- HHroster %>%
mutate(C040102_uppersec_open = case_when(
  agetouse %in% 19:34 & uppersec_complete == 1 ~ 1, #Upper secondary complete
  agetouse %in% 19:34 & is.na(uppersec_complete) ~ 0, #Upper secondary not complete
  TRUE ~ NA_real_)) 
```

```{r, eval=FALSE}
table(HHroster$C040102_primary_open)
table(HHroster$C040102_lowersec_open)
table(HHroster$C040102_uppersec_open)
```

### Figure for SDG 4.1.2 - Primary school by Population Groups
```{r}
##Table by population groups

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C040102_primary_open <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG4_2_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C040102_primary_open, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )

##Chart for the indicator above

ggplot(C040102_primary_open, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 4.1.2",
    subtitle = "Completion rate of primary school amongst those age 12 - 34 years.",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```


### Figure for SDG 4.1.2 -Primary school by Population Groups, Gender and disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/disability

C040102_primary_open_AGD <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07) & !is.na(HH_02) & !is.na(disability)) %>%  # Ensure disability is not missing
  group_by(Intro_07, HH_02, disability) %>%                          # Include disability in grouping
  summarise(
    var_name = "SDG 4.1.2 - primary",                
    num_obs_uw = survey_total(!is.na(C040102_primary_open), vartype = NULL),  
    denominator = survey_total(),                                
    mean_value = survey_mean(C040102_primary_open, vartype = c("ci", "se"), na.rm = TRUE)  
  )

## **Figure**

ggplot(C040102_primary_open_AGD, aes(x = HH_02, y = mean_value, fill = disability)) +  # Fill by disability
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  
  facet_wrap(~ Intro_07) +  
  labs(
     title = "Results of SDG 4.1.2",
    subtitle = "Completion rate of primary school amongst those age 12 - 34 years",
    x = "Gender",
    y = "Completed primary school",  
    fill = "Disability Status"   # Update legend label to reflect disability
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  
  )

```

### Figure for SDG 4.1.2 - Lower secondary school by Population Groups
```{r}
##Table by population groups

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C040102_lowersec_open <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG4_2_2 lower secondary",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C040102_lowersec_open, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )

##Chart for the indicator above

ggplot(C040102_lowersec_open, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 4.1.2",
    subtitle = "Completion rate of lower secondary school amongst those age 15 - 34 years.",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 4.1.2 - Lower secondary school by Population Groups, Gender and disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/disability

C040102_lowersec_open_AGD <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07) & !is.na(HH_02) & !is.na(disability)) %>%  # Ensure disability is not missing
  group_by(Intro_07, HH_02, disability) %>%                          # Include disability in grouping
  summarise(
    var_name = "SDG 4.1.2 - lower secondary",                
    num_obs_uw = survey_total(!is.na(C040102_primary_open), vartype = NULL),  
    denominator = survey_total(),                                
    mean_value = survey_mean(C040102_lowersec_open, vartype = c("ci", "se"), na.rm = TRUE)  
  )

## **Figure**

ggplot(C040102_lowersec_open_AGD, aes(x = HH_02, y = mean_value, fill = disability)) +  # Fill by disability
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  
  facet_wrap(~ Intro_07) +  
  labs(
     title = "Results of SDG 4.1.2",
    subtitle = "Completion rate of lower secondary school amongst those age 15 - 34 years",
    x = "Gender",
    y = "Completed lower secondary school",  
    fill = "Disability Status"   # Update legend label to reflect disability
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  
  )

```

### Figure for SDG 4.1.2 - Upper secondary school by Population Groups
```{r}
##Table by population groups

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C040102_uppersec_open <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG4_2_2 upper secondary",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C040102_uppersec_open, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )

##Chart for the indicator above

ggplot(C040102_uppersec_open, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 4.1.2",
    subtitle = "Completion rate of upper secondary school amongst those age 19 - 34 years.",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```
### Figure for SDG 4.1.2 - Upper secondary school by Population Groups, Gender and disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/disability

C040102_uppersec_open_AGD <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07) & !is.na(HH_02) & !is.na(disability)) %>%  # Ensure disability is not missing
  group_by(Intro_07, HH_02, disability) %>%                          # Include disability in grouping
  summarise(
    var_name = "SDG 4.1.2 - upper secondary",                
    num_obs_uw = survey_total(!is.na(C040102_primary_open), vartype = NULL),  
    denominator = survey_total(),                                
    mean_value = survey_mean(C040102_uppersec_open, vartype = c("ci", "se"), na.rm = TRUE)  
  )

## **Figure**

ggplot(C040102_uppersec_open_AGD, aes(x = HH_02, y = mean_value, fill = disability)) +  # Fill by disability
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  
  facet_wrap(~ Intro_07) +  
  labs(
     title = "Results of SDG 4.1.2",
    subtitle = "Completion rate of upper secondary school amongst those age 19 - 34 years",
    x = "Gender",
    y = "Completed lower secondary school",  
    fill = "Disability Status"   # Update legend label to reflect disability
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  
  )

```


## 4.2.2 SDG Indicator

**Participation rate in organized learning (one year before the official primary entry age), by sex**

Indicator Code: C040202

The participation rate in organized learning (one year before the official primary entry age), by sex is defined as the percentage of children in the given age range who participate in one or more organized learning programme, including programmes which offer a combination of education and care. Participation in early childhood and in primary education are both included. The age range will vary by country depending on the official age of entry to primary education.

| Standard Questions                                     |
|:------------------------------------------------------:|
|    HH_Educ00                                           |


**Unit of observation**: Individual 

**Numerator**:  enrollment in early childhood or primary education (ISCED levels 0 and 1) aged one year below the official entry age a to primary education

**Denominator**:  school-age population aged one year below the official entry age a to primary education

**Dataset**: HHroster

**Sources**  
1.[SDG 4.2.2 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-04-02-02.docx&wdOrigin=BROWSELINK)
2.[ISCED Diagrams](https://isced.uis.unesco.org/visualizations/)

```{r, eval=FALSE}
summary(HHroster$agetouse) # Age of the individual
table(HHroster$HH_Educ00) # Is [child name] currently going to pre-school?
```

```{r, eval=FALSE}
#Prior to calculating the indicator, check the official entry age to primary school in the country where the survey took place. Our calculation is done on the data from FDS Pakistan, where the official entry age to primary education is 5. 
HHroster <- HHroster %>%
mutate(C040202 = case_when(
  agetouse == 4 & HH_Educ00 == 1 ~ 1, #Assigns 1 when a child age 4 is enrolled in pre-school. 
  agetouse == 4 & HH_Educ00 %in% c(2, 98, 99) ~ 0))%>% #Assigns 2 when a child age 4 is not enrolled in pre-school, refuse to answer or don't know. 
mutate(C040202 = labelled(C040202, #Add labels
                               labels = c(
                                 "Yes" = 1,
                                 "No" = 0
                               ),
                               label = "participation rate in organized learning one year before the official entry age to primary education "))
```
```{r, eval=FALSE}
table(HHroster$C040202)
```
### Figure for SDG 4.2.2 by Population Groups
```{r}
##Table by population groups

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C040202 <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG4_2_2",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C040202, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )

##Chart for the indicator above

ggplot(C040202, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 4.2.2",
    subtitle = "Participation rate in organized learning one year before the official entry age to primary education (children age 4 years)",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 4.2.2 by Population Groups and Gender 

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C040202_AGD <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07) & !is.na(HH_02)) %>%  #
  group_by(Intro_07, HH_02) %>%                          
  summarise(
    var_name = "SDG 4.2.2",                
    num_obs_uw = survey_total(!is.na(C040202), vartype = NULL),  
    denominator = survey_total(),                                
    mean_value = survey_mean(C040202, vartype = c("ci", "se"), na.rm = TRUE)  
  )

## **Figure**

ggplot(C040202_AGD, aes(x = HH_02, y = mean_value, fill = HH_02)) + 
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  
  facet_wrap(~ Intro_07) +  
  labs(
     title = "Results of SDG 4.2.2",
    subtitle = "Participation rate in organized learning one year before the official entry age to primary education (children age 4 years)",
    x = "Gender",
    y = "Proportion of children enrolled in primary school at age 4",  
    fill = "Gender"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  
  )
```

## 4.3.1 SDG Indicator 

**Participation rate of youth and adults in formal and non-formal education and training in the previous 12 months, by sex**

Indicator Code: C040301

The percentage of youth and adults in a given age range (15-24 years, 25-54 years, 55-64 years, 15-64 years) participating in formal or non-formal education and training in the previous 12 months.

**Formal education and training** is defined as education provided by the system of schools, colleges, universities and other formal educational institutions that normally constitutes a continuous ‘ladder’ of full-time education for children and young people, generally beginning at the age of 5 to 7 and continuing to up to 20 or 25 years old. In some countries, the upper parts of this ‘ladder’ are organized programmes of joint part-time employment and part-time participation in the regular school and university system.


**Non-formal education and training** is defined as any organized and sustained learning activities that do not correspond exactly to the above definition of formal education. Non-formal education may therefore take place both within and outside educational institutions and cater to people of all ages. Depending on national contexts, it may cover educational programmes to impart adult literacy, life-skills, work-skills, and general culture.

| Standard Questions                                                               |
|:--------------------------------------------------------------------------------:|
|    HH_Educ02a_RA, EducR08, EducR13, EducR14b                                     |

**Unit of observation**: Individual

**Numerator**:  enrollment of the population in age group in formal and non-formal education and training

**Denominator**:  population in age group

**Dataset**: RA_adult

*Note that the question on current education is asked only to those older than 4 and younger than 45, therefore in this indicator we will assess the following age groups: 15-24 years, 25-45 years. This might differ, depending on the country of where the survey took place. Ensure to check this information and adjust the script if needed, prior to calculating this indicator. 
Additionally, we are only able to assess the current enrollment in education and apprenticeship, and participation in training in the previous 12 months. 

**Sources**  
1.[SDG 4.3.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-04-03-01.docx&wdOrigin=BROWSELINK)


```{r, eval=FALSE}
table(RA_adult$HH_Educ02a_RA) #Are you currently going to school? 
table(RA_adult$EducR08)       #Have you ever completed an apprenticeship?
table(RA_adult$EducR13)       #Have you ever participated in any training courses, such as work-related training or private skills training, that lasted at least 5 days or 30 hours, and not part of the formal educational system?
table(RA_adult$EducR14b)      #Did any of these training courses take place in the past 12 months?
table(RA_adult$age_selected)  #Age of the respondent

```
ILGI: We can only make the calculation for those who are currently in school and younger than 45, and if they are currently doing an apprenticeship, and if they have done any training in the last 12m. However, we can not include those who are not in school but have been in school in the last 12 months (in a scenario where they just finished school for example), nor those that are not doing an apprenticeship now but have done it in the last 12m. 
ILGI: Questions on current enrollment in formal education are asked in the roster to everyone, vs questions on apprenticeship and training are asked only to the random adult. Here I took the current educ enrollment status of the Random Adult and pulled it to the RA_adult dataset, and then calculated the indicator on the basis of the responded from the RA_adult. 


```{r, eval=FALSE}
#Step 1: Calculate indicator for age group 15-24 year
RA_adult <- RA_adult %>%
  mutate(
    C040301_15_24 = case_when(
      (age_selected %in% c(15:24) & (HH_Educ02a_RA == 1 | EducR08 == 3 | (EducR13 == 1 & EducR14b == 1))) ~ 1, 
      (age_selected %in% c(15:24) & (HH_Educ02a_RA %in% c(2, 98, 99) & EducR08 %in% c(2, 98, 99) & EducR13 %in% c(2, 98, 99)) ~ 0)))%>%
mutate(C040301_15_24 = labelled(C040301_15_24, #Add labels
                               labels = c(
                                 "Yes" = 1,
                                 "No" = 0
                               ),
                               label = "Participation rate of youth and adults (15 - 24 years) in formal and non-formal education and training"))
```
```{r, eval=FALSE}
table(RA_adult$C040301_15_24)
```
```{r, eval=FALSE}
#Step 1: Calculate indicator for age group 25-45 years
RA_adult <- RA_adult %>%
  mutate(
    C040301_25_45 = case_when(
      (age_selected %in% c(25:45) & (HH_Educ02a_RA == 1 | EducR08 == 3 | (EducR13 == 1 & EducR14b == 1))) ~ 1, 
      (age_selected %in% c(25:45) & (HH_Educ02a_RA %in% c(2, 98, 99) & EducR08 %in% c(2, 98, 99) & EducR13 %in% c(2, 98, 99)) ~ 0)))%>%
mutate(C040301_25_45 = labelled(C040301_25_45, #Add labels
                               labels = c(
                                 "Yes" = 1,
                                 "No" = 0
                               ),
                               label = "Participation rate of youth and adults (25 - 45 years) in formal and non-formal education and training"))
```
```{r, eval=FALSE}
table(RA_adult$C040301_25_45)
```


### Figure for SDG 4.3.1 - AGE GROUP 15 - 24 by Population Groups


```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C040301_15_24 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG4.3.1 (15 - 24 years of age)",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C040301_15_24, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above



ggplot(C040301_15_24, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 4.3.1",
    subtitle = "Participation rate of youth and adults (15 - 24 years) in formal and non-formal education and training",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 4.3.1 -  AGE GROUP 15 - 24 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C040301_15_24_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG4.3.1 (15 - 24 years of age)",                # Name of the variable
    num_obs_uw = survey_total(!is.na(C040301_15_24), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C040301_15_24, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

## figure

ggplot(C040301_15_24_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Results of SDG 4.3.1",
    subtitle = "Participation rate of youth and adults (15 - 24 years) in formal and non-formal education and training",
    x = "Gender ",
    y = "Proportion of those participating",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )
```

### Figure for SDG 4.3.1 - AGE GROUP 25 - 45 by Population Groups


```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C040301_25_45 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG4.3.1 (25 - 45 years of age)",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C040301_25_45, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above



ggplot(C040301_25_45, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 4.3.1",
    subtitle = "Participation rate of youth and adults (25 - 45 years) in formal and non-formal education and training",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 4.3.1 -  AGE GROUP 25 - 45 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C040301_25_45_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG4.3.1 (25 - 45 years of age)",                # Name of the variable
    num_obs_uw = survey_total(!is.na(C040301_15_24), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C040301_25_45, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

## figure

ggplot(C040301_25_45_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Results of SDG 4.3.1",
    subtitle = "Participation rate of youth and adults (25 - 45 years) in formal and non-formal education and training",
    x = "Gender ",
    y = "Proportion of those participating",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )
```
## 4.5.1 SDG Indicator

**Parity indices (female/male, rural/urban, bottom/top wealth quintile and others such as disability status, indigenous peoples and conflict-affected, as data become available) for all education indicators on this list that can be disaggregated**

Indicator Code: C040501

## 5.3.1 SDG Indicator

**Proportion of women aged 20–24 years who were married or in a union before age 15 and before age 18**

Indicator Code: C050301

Both formal (i.e., marriages) and informal unions are covered under this indicator. Informal unions are generally defined as those in which a couple lives together for some time, intends to have a lasting relationship, but for which there has been no formal civil or religious ceremony (i.e., cohabitation)

Marriage before the age of 18 is a fundamental violation of human rights. Child marriage often compromises a girl’s development by resulting in early pregnancy and social isolation, interrupting her schooling, limiting her opportunities for career and vocational advancement and placing her at increased risk of intimate partner violence. In many cultures, girls reaching puberty are expected to assume gender roles associated with womanhood. These include entering a union and becoming a mother. The practice of early/child marriage is a direct manifestation of gender inequality.

| Standard Questions |
|:------------------:|
|    HH_09           |

**Unit of observation**: Individual

**Numerator**: Number of women aged 20-24 who were first married or in union before age 15 (or before age 18)

**Denominator**: Total number of women aged 20-24

**Dataset**: HHroster

**Sources**  
1.[SDG 5.3.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-05-03-01.docx&wdOrigin=BROWSELINK)

```{r, eval=FALSE}
summary(HHroster$HH_09) #How old were you when you first married? 
```

```{r, eval=FALSE}
#Married or in union before age 15 

HHroster <- HHroster %>%
  mutate(
    women20_24 = case_when(
      as.numeric(HH_02) == 2 & (as.numeric(agetouse) >= 20 & as.numeric(agetouse) <= 24) ~ 1,
      TRUE ~ 0
    )
  )


HHroster <- HHroster %>%
  mutate(
  married_before_15 = case_when(
      women20_24 == 1 & HH_09 < 15 ~ 1,
      TRUE ~ 0))

numerator_15 <- sum(HHroster$married_before_15, na.rm = TRUE)
denominator_15 <- sum(HHroster$women20_24, na.rm = TRUE)
proportion_15 <- (numerator_15 / denominator_15) * 100
cat("Proportion of women aged 20-24 married before age 15:", round(proportion_15, 2), "%\n")

```
```{r, eval=FALSE}
#Married or in union before age 18 

HHroster <- HHroster %>%
  mutate(
  married_before_18 = case_when(
      women20_24 == 1 & HH_09 < 18 ~ 1,
      TRUE ~ 0))

numerator_18 <- sum(HHroster$married_before_18, na.rm = TRUE)
denominator_18 <- sum(HHroster$women20_24, na.rm = TRUE)
proportion_18 <- (numerator_18 / denominator_18) * 100
cat("Proportion of women aged 20-24 married before age 18:", round(proportion_18, 2), "%\n")
```


### Figure for SDG 5.3.1a by Population Groups

```{r, eval=FALSE}

###Results of the indicator table

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

##Table 

C050301a <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%         # Exclude if pop_groups is NA
  group_by(Intro_07) %>%                  # Group by pop_groups
  summarise(
    var_name = "SDG 5.3.1a",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(women20_24), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(women20_24, na.rm = TRUE),         # Weighted total count
    married_before_15_total = survey_total(married_before_15, na.rm = TRUE),   # Total for edu_primary
    women20_24_total = survey_total(women20_24, na.rm = TRUE)    # Total for age_primary
  ) %>%
  mutate(
    mean_value = round(married_before_15_total / women20_24_total, 4)  # Calculate the mean value
  )


##Figure 


ggplot(C050301a, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Corrected the misplaced `width`
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(width = 0.7)) +  # Correct text positioning
  scale_y_continuous(limits = c(0, 1.2), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 5.3.1a - Women age 20 - 24 years married before the age of 15",
    x = "Population Groups",
    y = "Mean Value"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +         # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```

```{r, eval=FALSE}

###Results of the indicator table

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

##Table 

C050301b <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%         # Exclude if pop_groups is NA
  group_by(Intro_07) %>%                  # Group by pop_groups
  summarise(
    var_name = "SDG 5.3.1b",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(women20_24), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(women20_24, na.rm = TRUE),         # Weighted total count
    married_before_18_total = survey_total(married_before_18, na.rm = TRUE),   # Total for edu_primary
    women20_24_total = survey_total(women20_24, na.rm = TRUE)    # Total for age_primary
  ) %>%
  mutate(
    mean_value = round(married_before_18_total / women20_24_total, 4)  # Calculate the mean value
  )


##Figure 


ggplot(C050301b, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Corrected the misplaced `width`
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(width = 0.7)) +  # Correct text positioning
  scale_y_continuous(limits = c(0, 1.2), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 5.3.1a - Women age 20 - 24 years married before the age of 18",
    x = "Population Groups",
    y = "Mean Value"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +         # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```


## 5.a.1 SDG Indicator 

**(a) Proportion of total agricultural population with ownership or secure rights over agricultural land, by sex; and (b) share of women among owners or rights-bearers of agricultural land, by type of tenure**

Indicator Code: C050a01

## 5.b.1 SDG Indicator

**Proportion of individuals who own a mobile telephone, by sex**

Indicator Code: C050b01

An individual owns a mobile cellular phone if he/she has a mobile cellular phone device with at least one active SIM card for personal use. Mobile cellular phones supplied by employers that can be used for personal reasons (to make personal calls, access the Internet, etc.) are included. Individuals who have only active SIM card(s) and not a mobile phone device are excluded. Individuals who have a mobile phone for personal use that is not registered under his/her name are also included. An active SIM card is a SIM card that has been used in the last three months.

A mobile (cellular) telephone refers to a portable telephone subscribing to a public mobile telephone service using cellular technology, which provides access to the Public Switched Telephone Network (PSTN). This includes analogue and digital cellular systems and technologies such as IMT-2000 (3G) and IMT-Advanced. Users of both postpaid subscriptions and prepaid accounts are included.

| Standard Questions             |
|:------------------------------:|
|IA01, IA01_1                    | 


**Numerator**: Individuals owning a mobile phone 

**Denominator**: Total number of individuals

**Dataset**: RA_adult

**Sources**  
1.[SDG 5. b. 1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-05-0B-01.docx&wdOrigin=BROWSELINK)

```{r, eval=FALSE}
#Step 1: check all variables
table(RA_adult$IA01)   #Do you yourself  have your own  mobile phone?
table(RA_adult$IA01_1) #Does the mobile phone you own have an active SIM card?  An active SIM card is a card that has been used in the past three months.
```

```{r, eval=FALSE}
#ILGI: A response option in both above questions is Not needed. Those that do not need a mobile phone or an active sim card. I have put them in 0 for now, as even if they don't need it they still don't have it. Do you agree? 
## Step 2: Add a column specifying if the household uses improved or unimproved source of drinking water 
RA_adult <- RA_adult %>%
mutate(C050b01 = case_when(
  IA01 == 1 & IA01_1 == 1 ~ 1, #Assign 1 when an individual has a mobile phone with active sim card
  IA01 == 1 & IA01_1 %in% c(2,3) ~ 0, #Assign 0 when an individual has a mobile phone without and active sim card
  IA01 == 2 & IA01 == 3 ~ 0))%>% #Assigns 0 when an individual does not have a mobile phone or doesn't need one.
  mutate(C050b01 = labelled(C050b01, #Add labels
                               labels = c(
                                 "Yes" = 1,
                                 "No" = 0
                               ),
                               label = "Ownership of a mobile phone"))
 
table(RA_adult$C050b01)
```

### Figure for SDG 5.b.1 by Population Groups


```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C050b01 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG5_b_1",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C050b01, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above



ggplot(C050b01, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 5.b.1",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 5.b.1 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C050b01_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(Intro_07)) %>%  
  group_by(Intro_07, HH_02_RA) %>%  
  summarise(
    var_name = "impact3_3",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(C050b01), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C050b01, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

ggplot(C050b01_AGD, aes(x = HH_02_RA, y = mean_value, fill = HH_02_RA)) +  # Removed disability_RA from fill
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of adults owning a mobile phone",
    x = "Gender",
    y = "Those who declare feeling safe",
    fill = "Gender"  # Adjusted fill label
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```
## 6.1.1 SDG Indicator

**Proportion of population using safely managed drinking water services**

Indicator Code: C060101

Access to Basic Drinking Water Services refers to the use of drinking water from an improved source with a collection time of not more than 30 minutes for a round trip, including queuing. ‘Improved’ drinking water sources include the following:: piped water, boreholes or tube wells, protected dug wells, protected springs, rainwater, water kiosks, and packaged or delivered water. This definition is based on the WHO/UNICEF Joint Monitoring Programme (JMP) drinking water ladder. 

1. Improved water source.
2. The RA_adult water source is located within the household's dwelling or yard, or it is reachable within a 30-minute round trip, including any time spent queuing.

| Standard Questions                |
|:---------------------------------:|
| BD01, BD01a, BD20_2, BD20_3, BD22 |

**Numerator**: Individuals using drinking water from an improved source, provided collection time is not more than 30 minutes for a round trip, including queuing. 

**Denominator**: Total number of individuals

**Dataset**: main

**Sources**  
1.[SDG 6.1.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-06-01-01.docx&wdOrigin=BROWSELINK)
2.[JMP WASH guidance](https://washdata.org/sites/default/files/documents/reports/2019-03/JMP-2018-core-questions-for-household-surveys.pdf).

```{r, eval=FALSE}
##Step 1: Check all variables
table(main$BD01)   ##What is the main source of drinking water used by members of your household?
table(main$BD01a)  ##Where is this main drinking water source located? In your own dwelling, in your own yard or plot , or elsewhere?
table(main$BD20_2) ##How long does it take for members of your household to go to the main source of drinking water, stay in a queue, get water, and come back? Please do not include time spent socializing. 
table(main$BD20_3) ##Specifying minutes on how long it takes to collect water 
table(main$BD22)   ##Does it take more or less than 30 minutes?


## Step 2: Add a column specifying if the household uses improved or unimproved source of drinking water 
main <- main %>%
mutate(Improved_dw = ifelse(BD01 %in% c(11, 12, 13, 14, 21, 31, 41, 51, 61, 71, 72, 91, 92), 1, 0)) %>%
  mutate(Improved_dw = labelled(Improved_dw,
                               labels = c(
                                 "Yes" = 1,
                                 "No" = 0
                               ),
                               label = "Improved drinking water source"))

##Step 3: Add a coloumn specifying if the improved water source is located in own dwelling/yard/plot or elsewhere. 
main <- main %>%
mutate(Improved_dw_Loc = case_when(
BD01 %in% c(11, 12) ~ 1, #Assigns 1 if piped into dwelling/yard/plot
BD01 %in% c(13, 14, 21, 31, 41, 51) & BD01a %in% c(1, 2) ~ 1, #Assigns 1 if other source located in HH dwelling or plot
BD01 %in% c(13, 14, 21, 31, 41, 51) & BD01a == 3 ~ 0))%>% #Assigns 2 if other source located elsewhere
mutate(Improved_dw_Loc = labelled(Improved_dw_Loc,
                               labels = c(
                                 "Own dwelling/yard/plot" = 1,
                                 "Elsewhere" = 0
                               ),
                               label = "Improved drinking water source in own dwelling, yard or plot"))

##Step 4: Add a coloumn specifying if it takes more or less than 30 min to the improved drinking water source. If the improved drinking water source is located in own dwelling, yard or plot, it is considered that it takes less than 30 minutes to reach. 
## BD20_3 - Minutes

main <- main %>%
  mutate(
    Improved_dw_access = case_when(
      BD01 %in% c(11, 12,91,92) ~ 1, #Assigns 1 if improved water source is "Piped to plot/yard/dwelling", "Bottled water" or "Sachets". 
      BD01 %in% c(13, 14, 21, 31, 41, 51, 61, 71, 72) & ((BD20_2 == 1 & BD20_3 < 30) | (BD20_2 == 98 & BD22 == 1)) ~ 1, #Assigns 1 if other improved water source which are reachable in less than 30 minutes. 
      TRUE ~ 0))%>% #Assigns 0 in all other cases. 
mutate(Improved_dw_access = labelled(Improved_dw_access,
                               labels = c(
                                 "Yes" = 1, 
                                 "No" = 0
                               ),
                               label = "Improved water source located reachable in less than 30min"))
      
      
main <- main %>%
  mutate(
    C060101 = case_when(
      Improved_dw == 1 & (Improved_dw_Loc == 1 | Improved_dw_access == 1)~ 1, #Assigns 1 when an improved water source is located on premises or reachable in less than 30 min. 
      TRUE ~ 0
    )
  ) %>%
  mutate(C060101 = labelled(C060101,
                               labels = c(
                                 "Yes" = 1, 
                                 "No" = 0
                               ),
                               label = "Access to clean drinking water services"))



table(main$C060101)


```

### Figure for SDG 6.1.1 by Population Groups


```{r, eval=FALSE}


##Table by population groups

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C060101 <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG6.1.1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C060101, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of SDG 6.1.1 by pop groups

ggplot(C060101, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 6.1.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```

## 6.2.1 SDG Indicator

**Proportion of population using (a) safely managed sanitation services and (b) a hand-washing facility with soap and water**

Indicator Code: C060102

In FDS, we are able to calculate (b) aspect of this indicator. 

The proportion of the population with basic hygiene services is defined as the proportion of population with a handwashing facility with soap and water available at home. Hand washing facilities may be located within the dwelling, yard or plot. They may be fixed or mobile and include a sink with tap water, buckets with taps, tippy-taps, and jugs or basins designated for hand washing. Soap includes bar soap, liquid soap, powder detergent, and soapy water but does not include ash, soil, sand or other handwashing agents.

| Standard Questions             |
|:------------------------------:|
| HW2_OB, HW3_OB, HW4_OB, HW8_OB |

**Unit of observation**: Household

**Numerator**:  Number of individuals with access to with basic hand washing facilities on premises

**Denominator**: Total number of individuals

**Dataset**: main

**Sources**  
1.[SDG 6.2.1a Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-06-02-01b.docx&wdOrigin=BROWSELINK)
2.[JMP Methodology](https://washdata.org/reports/jmp-2017-methodology)

```{r, eval=FALSE}
table(main$HW2_OB) #Can you please show me where members of your household most often wash their hands?
table(main$HW3_OB) #Observe presence of water at the place for hand washing. Verify by checking the tap/pump, or basin, bucket, water container or similar objects for presence of water.
table(main$HW4_OB) #Is soap or detergent or ash/mud/sand present at the place for hand washing?
table(main$HW8_OB) #Type of soap
```


```{r, eval=FALSE}
#Step 1: Create a variable which checks for the type of hand washing facility

main <- main %>%
  mutate(handwashing_type = case_when(
    HW2_OB  %in% c(1,2,3) ~ 1, #Assigns 1 when the observed hand washing facility is fixed facility (sink,tap) in yard/plot/dwelling or mobile hand washing facility
    HW2_OB %in% c(4,96) ~ 0, #Assigns 0 when there is no hand washing facility observed in dwelling/yard/plot or when the answer is other,specify
    HW2_OB == 5 ~ NA )) #Assigns NA where the permission to observe the hand washing facility is not given

#Step 2: Create a variable checking for the presence of water
main <- main %>%
  mutate(handwashing_water = case_when(
    HW3_OB == 1 ~ 1, #Assigns 1 when water is present
    HW3_OB == 2 ~ 0)) #Assigns 0 when water is not present
    
#Step 3: Create a variable checking for the presence and type of soap
main <- main %>%
  mutate(handwashing_soap = case_when(
    HW4_OB == 1 & HW8_OB %in% c("A","B")~ 1, #Assigns 1 when soap is present and type is bar soap, liquid soap, powder detergent, and soapy water
    HW4_OB == 1 & HW8_OB %in% c("C")~ 0, #Assigns 0 when soap is present and type is ash, soil, sand
    HW4_OB == 2 ~ 0)) #Assigns 0 when soap is not present

#Step 4: Combine all 3 conditions to a final variable
main <- main %>%
  mutate(C060102 = case_when(
    handwashing_type == 1 & handwashing_water == 1 & handwashing_soap == 1 ~ 1,
    handwashing_type == 0 | handwashing_water == 0 | handwashing_soap == 0 ~ 0))%>%
  mutate(C060102 = labelled(C060102,
                                labels = c(
                                  'Yes' = 1,
                                  'No' = 0
                                ),
                                label = "Proportion of people with basic hygiene services "))

table(main$C060102)

```

### Figure for SDG 6.1.2 by Population Groups


```{r, eval=FALSE}


##Table by population groups

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C060102 <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "outcome12_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C060102, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of outcome 12_1 by pop groups

ggplot(C060102, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 6.1.2",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```


## 7.1.1 SDG Indicator

**Proportion of population with access to electricity**

Indicator Code: C070101

Proportion of population with access to electricity is the percentage of population with access to electricity. SDG7 ensures access to affordable, reliable, sustainable and modern energy for all. Specifically, Indicator 7.1.1 refers to the proportion of population with access to electricity.

Access to electricity addresses major critical issues in all the dimensions of sustainable development. The target has a wide range of social and economic impacts, including facilitating development of income generating activities and lightening the burden of household tasks.

Under the global target of equal access to energy, SDG7.1.1 focuses specifically on electricity access available to the global population. In order to gain a clear picture, access rates are only considered if the primary source of lighting is the local electricity provider, solar systems, mini-grids and stand-alone systems. Sources such as generators, candles, batteries, etc., are not considered due to their limited working capacities and since they are usually kept as backup sources for lighting.

Calculation is based on the World Bank Multi-Tier Framework for Measuring Electricity Access. In Tier 1, households are considered to have electricity based on capacity of the main source of electricity to operate different appliances and availability of electricity supply (on average at least one hour of electricity in the evening during the previous week). Population with access to electricity (Tier 1 or above for all attributes) are defined as having access to electricity

| Standard Questions                                   |
|:----------------------------------------------------:|
| HE01, HE02a, HE02b, HE04_summinutes, HE05_summinutes |

**Unit of observation**: Household

**Numerator**:   Households with access to electricity from TIER 1 or above

**Denominator**: Total households

**Dataset**: main

**Sources**  
1.[SDG 7.1.1 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-07-01-01.docx&wdOrigin=BROWSELINK)
2.[World Bank LSMS Energy guidance](https://documents1.worldbank.org/curated/en/557341633679857128/pdf/Measuring-Energy-Access-A-Guide-to-Collecting-Data-Using-the-Core-Questions-on-Household-Energy-Use.pdf)

```{r, eval=FALSE}
table(main$HE01)  #What source of electricity is used **most** of the time in this household?
table(main$HE02a) #Which of your household appliances are powered using this household’s ${HE01_response}?
table(main$HE02b) #How many light bulbs can be powered using this household's ${HE01_response}?
table(main$HE04_summinutes)  #In the **past 7 days**, on average how many hours of electricity were available per day?
table(main$HE05_summinutes)  #In the past 7 days, on average how many hours of electricity were available each evening, from 6:00pm to 10:00pm from ${HE01_response}?
```

```{r, eval=FALSE}
#Step 1: Assess the capacity of electricity 
main <- main %>%
  mutate(
    C070101 = case_when(
      (HE01 %in% c(1,2) & (HE05_hours >= 1 & HE05_hours != 98)) ~ 1, #If the main source of electricity is national gird or mini-grid which is available at least 1 hour every evening, then Capacity is above tier 1.  
      HE01 %in% c(3,5,6) & HE02a %in% c("A", "B", "C", "D", "E", "F", "G") ~ 1, #If the main source of electricity is solar home system, electric generator or rechargeable batter & the household is able to power at least a small device, then Capacity is above tier 1.
      HE01 == 4 & HE02a %in% c("A", "B") & HE02b >= 2  ~ 1, # If households use a solar lantern, can power either a mobile charger or radio, and use multiple light bulbs, capacity tier is at least 1. 
      TRUE ~ 0)) #All other cases, capacity of electricity is below tier 1.  

main <- main %>%
   mutate(C070101 = labelled(C070101,
                                labels = c(
                                  "Yes" = 1,  # Label for Yes
                                  "No" = 0   # Label for No
                                ),
                                label = "Proportion of households with access to electricity from TIER 1 or above"))
```
```{r}
table(main$C070101)
```

## Figure for SDG 7.1.1 by Population Groups


```{r, eval=FALSE}


##Table by population groups

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C070101 <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG7.1.1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C070101, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of SDG 7.1.1 by pop groups

ggplot(C070101, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 7.1.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```

## 7.1.2 SDG Indicator

**Proportion of population with primary reliance on clean fuels and technology**

Indicator Code: C070102

Proportion of population with primary reliance on clean fuels and technology is calculated as the number of people using clean fuels and technologies for cooking, heating and lighting divided by total population reporting that any cooking, heating or lighting, expressed as percentage. “Clean” is defined by the emission rate targets and specific fuel recommendations (i.e. against unprocessed coal and kerosene) included in the normative guidance WHO guidelines for indoor air quality: household fuel combustion. 

| Standard Questions                                        |
|:---------------------------------------------------------:|
| HC01, HC02, HC04, HHT01, HHT04, HHT06, HL01, HL03, EMP06d |

**Unit of observation**: Household

**Numerator**:   Number of individuals using clean fuel and technology as their primary source of cooking, heating and lighting

**Denominator**: Total number of individuals

**Dataset**: main

To calculate the indicator value, the standard survey methodology considers in the numerator only individuals in households that use one of the following most of the time as their source for cooking are considered in the numerator:

  + solar cooker
  + electric stove
  + piped natural gas stove
  + biogas stove
  + LPG/cooking gas stove
  + liquid fuel stove with alcohol / ethanol
  

**Sources**  
1.[SDG 7.1.2 Metadata Guidance](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-07-01-02.docx&wdOrigin=BROWSELINK)
2.[World Bank LSMS Energy guidance](https://documents1.worldbank.org/curated/en/557341633679857128/pdf/Measuring-Energy-Access-A-Guide-to-Collecting-Data-Using-the-Core-Questions-on-Household-Energy-Use.pdf)


```{r, eval=FALSE}
#Step 1: Calculate clean fuel for cooking 
table(main$HC01) #Is any food or drink consumed by household members cooked or prepared at the household dwelling using a cookstove, fire or other cooking device?
table(main$HC02) #What does this household use for cooking most of the time, including cooking food, making tea/ coffee, boiling drinking water?
table(main$HC04) #What type of fuel or energy source does this household use most of the time in this ${HC02_response} for cooking food, making tea/coffee and boiling drinking water?

main <- main %>%
  mutate(
    clean_cook = case_when(
      (HC01 == 1 & (HC02 %in% c(1, 2, 3, 4, 5)) | (HC01 == 1 & HC02 == 8 & HC04 == 2)
      ) ~ 1,  # First condition for clean cooking
      (HC01 == 1 & (HC02 %in% c(6,7,9,10,11,96)) | (HC02 == 8 & !(HC04== 2)
      )) ~ 0,  # Condition for unclean cooking or incomplete clean technology
      HC01 == 2 ~ 0,  # HC01 is "2"
      TRUE ~ NA_real_  # Handle missing or other cases
    )
  ) 
```
```{r, eval=FALSE}
table(main$clean_cook)
```

```{r, eval=FALSE}
#Step 2: Calculate clean fuel for heating
table(main$HHT01) #Does this household use any heating device or fire to keep the dwelling/living quarters warm at any time during the year?
table(main$HHT04) #What kind of device does this household use to heat the home when needed? For example, do you use a space heater(s), or use your cookstove in the winter for warmth?
table(main$HHT06) #What type of fuel or energy source does this household use **most of the time for heating** in ${HHT04_response}?
```

```{r, eval=FALSE}
#Note that the following types of heating: manufactured space heater, traditional space heater, manufactured cookstove and traditional cookstove are only considered clean when the brand of them is considered a clean brand based on the WHO guidelines. However we do not have the needed information to classify a brand as clean or unclean. Therefore households that use these types of heating have been classified as clean without including the brand names in the calculation. 
main <- main %>%
  mutate(
    clean_heating = case_when(
      HHT01 == 1 & HHT04 %in% c(1, 2, 3, 4, 5, 8) ~ 1, # Clean heating
      HHT01 == 1 & HHT04 %in% c(6, 7, 96) ~ 0,         # Unclean heating
      HHT01 == 2 ~ 0,                                  # No heating used
      TRUE ~ NA_real_                                  # Missing or other cases
    )
  )

```
```{r, eval=FALSE}
table(main$clean_heating)
```

```{r, eval=FALSE}
#Step 3: Calculate clean lightning
table(main$HL01) #Does this household use anything for lightning? 
table(main$HL03) # What does this household use **most of the time** as energy for lighting, or as a light source?
main <- main %>%
  mutate(
    clean_lightning = case_when(
      HL01 == 1 & HL03 %in% c(1, 2, 3, 4, 5, 6) ~ 1, # Clean lighting
      HL01 == 1 & HL03 %in% c(7,9,9,10,11,96) ~ 0,   # Unclean lighting
      HL01 == 2 ~ 0,                                  # No lighting
      TRUE ~ NA_real_                                  # Missing or other cases
    )
  )

```
```{r, eval=FALSE}
table(main$clean_lightning)
```

```{r, eval=FALSE}
#Step 4: Combine the three conditions above into a final indicator
main <- main %>%
  mutate(
    C070102 = case_when(
      clean_cook == 1 & clean_heating == 1 & clean_lightning == 1 ~ 1,
      clean_cook == 0 | clean_heating == 0 | clean_lightning == 0 ~ 0))
  
```
```{r, eval=FALSE}
main <- main %>%
   mutate(C070102 = labelled(C070102,
                                labels = c(
                                  "Clean fuel" = 1,  # Label for Yes
                                  "Unclean fuel" = 0   # Label for No
                                ),
                                label = "Proportion of population with primary reliance on clean fuels and technology"))
```

### Figure for SDG 7.1.2 by Population Groups

```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C070102 <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG7.1.2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C070102, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C070102, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 7.1.2",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

## 8.3.1 SDG Indicator

**Proportion of informal employment in total employment, by sector and sex**
Indicator Code: C080302

This indicator presents the share of employment which is classified as informal employment in the total economy, and separately in agriculture and in non-agriculture.

| Standard Questions                                                                                                       |
|:------------------------------------------------------------------------------------------------------------------------:|
| EMP01, EMP02, EMP03, EMP04, EMP05, EMP06a, EMP06b, EMP06c, EMP09, EMP10, EMP10_4,  EMP10_5, EMP10_6, EMP10_6a, EMP10_7   |

**Employment** comprises all persons of working age who, during a short reference period (one week), were engaged in any activity to produce goods or provide services for pay or profit.

**Informal employment** comprises persons who in their main or secondary jobs were in one of the following categories:
- Own-account workers, employers and members of producers’ cooperatives employed in their own informal sector enterprise
- Own-account workers engaged in the production of goods exclusively for own final use by their household
- Contributing family workers if they work in formal or informal sector enterprises
- Employees holding informal jobs, whether employed by formal sector enterprises, informal sector enterprises, or as paid domestic workers by households. 

To classify persons into formal or informal employment for this indicator, only the characteristics of the main job are considered. 

**Unit of measure:**
Percent (%)

1. For: Proportion of informal employment in total employment 

**Numerator:** Informal employment

**Denominator:** Total employment 

**Dataset:** RA_adult

2. For: Proportion of informal employment in agriculture 

**Numerator:** Informal employment in agricultural activities

**Denominator:** Total employment in agriculture 

**Dataset:** RA_adult

3. For: Proportion of informal employment in non agriculture employment

**Numerator:** Informal employment in agricultural activities

**Denominator:** Total employment in non agricultural activities 

**Dataset:** RA_adult

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-08-03-01.docx&wdOrigin=BROWSELINK)
2. [Labour Force Statistics](https://ilostat.ilo.org/methods/concepts-and-definitions/description-labour-force-statistics/)


```{r, eval=FALSE}
table(RA_adult$EMP01) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you work for someone else for pay, for one or more hours?
table(RA_adult$EMP02) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you run or do any kind of business, farming or other activity to make money?
table(RA_adult$EMP03) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you help in a family business or farm?
table(RA_adult$EMP04) #Even though you did not work, during the past 7 days, did you have a paid job from which you were temporarily absent?
table(RA_adult$EMP05) #Even though you did not work, during the past 7 days, did you have a business or a helper job in a family business/farm from which you were temporarily absent?
table(RA_adult$EMP06a) #During the past 7 days, did you do any work in farming or rearing farm animals, fishing or fish farming, or none of these?
table(RA_adult$EMP06b) #Was this work that you mentioned in farming or rearing farming animals, fishing or fish farming, or none of these?
table(RA_adult$EMP06c) #Thinking about this work, are the products intended only for sale, mainly for sale, only for family use, or mainly for family use?
table(RA_adult$EMP09)  #Do you work as a paid employee, as a paid apprentice/intern/volunteer, as a paid incentive worker, in your own business, helping in a family or household business, or other?
table(RA_adult$EMP10_7) #Including yourself, how many people currently work in this business?
table(RA_adult$EMP10)  #In this job are you working in the government or a state-owned enterprise; a farm; a private non-farm business; a household as a domestic worker; an NGO; non-profit institution; religious institution; an international organization including UNCHR or a foreign embassy?
table(RA_adult$EMP10_4) #Does your employer pay contributions to the [Pension Fund/ Health/ Unemployment Insurance] for you?
table(RA_adult$EMP10_5) #Do you get paid annual leave?
table(RA_adult$EMP10_6) #Would you get paid sick leave in case of illness or injury?
table(RA_adult$EMP10_6a) #Would you get paid  [maternity/paternity] leave [if you deliver a child/if your spouse delivers a child]?
```

```{r}
#Step 1: Determine who is employed based on various conditions 
RA_adult <- RA_adult %>%
  mutate(employed = case_when(
    EMP01 == 1 ~ 1,  # Paid employment - employees
    (EMP02 == 1 & EMP06b == 3)  ~ 1,  # Self-employment
    (EMP03 == 1 & EMP06b == 3)  ~ 1,  # Unpaid contributing family workers
    EMP04 == 1  ~ 1,  # Absent but still employed
    (EMP05 == 1 & EMP06a == 3)  ~ 1,  # Absent but self-employed
    (EMP02 == 1 & EMP06b %in% c(1, 2) & EMP06c %in% c(1, 2))  ~ 1,  # Farming/rearing/fishing for sale
    (EMP05 == 1 & EMP06a %in% c(1, 2) & EMP06c %in% c(1, 2))  ~ 1,  # Absent but farming for sale
    TRUE ~ 0
  ))
```

```{r, eval=FALSE}
#Step 2: Status in employment based on isce93 
RA_adult <- RA_adult %>%
  mutate(isce93 = case_when(
    employed== 1 & EMP09 %in% c(1,2,3) ~ 1, #Employees
    employed== 1 & EMP09 == 4 & EMP10_7 > 1 ~ 2, #Employers - assuming that all workers are paid
    employed== 1 & EMP09 == 4 & EMP10_7 == 1 ~ 3, #Own-account workers
    employed== 1 & EMP09 == 5 ~ 4, # Contributing family workers
    employed== 1 & (EMP09 == 96 | is.na(EMP09)) ~ 5, #Workers not classifiable by status
    employed == 0 ~ NA_real_,  # Set to NA when employed == 0
    TRUE ~ NA_real_  # Default case (catches any unexpected values)
  ))
    
```
```{r, eval=FALSE}
#Step 3: Institutional sector of economic activities
RA_adult <- RA_adult %>%
  mutate(ins_sector = case_when(
    employed== 1 & EMP10 %in% c(1,6)~ 1, #Public 
    employed== 1 & EMP10 %in% c(2,3,5)~ 2, #Private
    employed== 1 & EMP10 == 4 ~ 3, # Household domestic worker
    employed== 1 & (EMP10 %in% c(96,98) | is.na(EMP10)) ~ 4)) #Not classified
```
```{r, eval=FALSE}
#Step 4: Employment benefits
#Social security contribution (proxy:pension fund)
RA_adult <- RA_adult %>%
  mutate(socsec = case_when(
  employed== 1 & EMP10_4 == 1  ~ 1, #Social security
  employed== 1 & EMP10_4 == 2  ~ 2, #No social security
  employed== 1 & (EMP10_4 == 98 | is.na(EMP10_4))  ~ 3)) #Not stated
```
```{r, eval=FALSE}
#Paid leave
RA_adult <- RA_adult %>%
  mutate(painleave = case_when(
  employed== 1 & EMP10_5 == 1  ~ 1, #Paid leave
  employed== 1 & EMP10_5 == 2  ~ 2, #No paid leave
  employed== 1 & (EMP10_5 == 98 | is.na(EMP10_5))  ~ 3)) #Not stated
```
```{r, eval=FALSE}
#Paid sick leave
RA_adult <- RA_adult %>%
  mutate(sickleave = case_when(
  employed== 1 & EMP10_6 == 1  ~ 1, #Sick leave
  employed== 1 & EMP10_6 == 2  ~ 2, #No sick leave
  employed== 1 & (EMP10_6 == 98 | is.na(EMP10_6))  ~ 3)) #Not stated
```
```{r, eval=FALSE}
#Parental leave
RA_adult <- RA_adult %>%
  mutate(parentalleave = case_when(
  employed== 1 & EMP10_6a == 1  ~ 1, #Parental leave
  employed== 1 & EMP10_6a == 2  ~ 2, #No parental leave
  employed== 1 & (EMP10_6a == 98 | is.na(EMP10_6a))  ~ 3)) #Not stated
```

```{r, eval=FALSE}
##Step 5: Characteristics of the enterprise
#Registration 
RA_adult <- RA_adult %>%
  mutate(registered = case_when(
  employed== 1 & EMP10_11 == 1 ~ 1, #Registered 
  employed== 1 & EMP10_11 == 2 ~ 2, #Not registered 
  employed== 1 & (EMP10_11 == 98 | is.na(EMP10_11)) ~ 3)) #Not stated 
#Bookkeeping 
RA_adult <- RA_adult %>%
  mutate(bookkeep = case_when(
  employed== 1 & EMP10_12 == 1 ~ 1, #Keep accounts for tax purposes - formal
  employed== 1 & EMP10_12 %in% c(2,3,4) ~ 2, #Keep accounts not for tax purposes; Personal use only; Does not keep accounts
  employed== 1 & (EMP10_12 == 98 | is.na(EMP10_12)) ~ 3)) #Not stated 

```

```{r}
#Step 6: Informal/formal economy
#UNIT OF PRODUCTION: FORMAL/INFORMAL SECTOR 
RA_adult <- RA_adult %>%
  mutate(unit_prod = case_when(
    employed == 1 & ins_sector == 3 ~ 3, # Households
    employed == 1 & (ins_sector == 1 | registered == 1 | bookkeep == 1) ~ 2, # Employment in formal sector
    employed == 1 & !(ins_sector == 3 | ins_sector == 1 | registered == 1 | bookkeep == 1) ~ 1, # Informal sector
    TRUE ~ NA_real_ # Default case for missing values
  ))
```
```{r}
#NATURE OF JOB: FORMAL/INFORMAL EMPLOYMENT 
RA_adult <- RA_adult %>%
  mutate(job_nature = case_when(
    (isce93  %in% c(2,3) & unit_prod !=2) | (isce93  %in% c(1, 5) & socsec !=1) | isce93 == 4 ~ 1, #Informal employment
    (isce93  %in% c(2,3) & unit_prod ==2) | (isce93  %in% c(1, 5) & (socsec ==1 | (socsec == 3 & painleave ==1 & sickleave ==1))) ~ 0)) #Formal employment 
    
```


### Figure for SDG 8.3.1 by Population Groups

```{r, eval=FALSE}

###Results of the indicator table

FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

##Table 

C080302 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%         # Exclude if pop_groups is NA
  group_by(Intro_07) %>%                  # Group by pop_groups
  summarise(
    var_name = "SDG8.3.1",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(employed), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(employed, na.rm = TRUE),         # Weighted total count
    job_nature_total = survey_total(job_nature, na.rm = TRUE),   # Total for edu_primary
    employed_total = survey_total(employed, na.rm = TRUE)    # Total for age_primary
  ) %>%
  mutate(
    mean_value = round(job_nature_total / employed_total, 4)  # Calculate the mean value
  )


##Figure 


ggplot(C080302, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Corrected the misplaced `width`
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(width = 0.7)) +  # Correct text positioning
  scale_y_continuous(limits = c(0, 1.2), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 8.3.1",
    x = "Population Groups",
    y = "Mean Value"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +         # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```
### Figure for SDG 8.3.1  by Gender and Population Groups


```{r, eval=FALSE}

###Table with gender included for the chart

C080302_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07) & !is.na(HH_02_RA)) %>%                     # Exclude if pop_groups is NA
  group_by(Intro_07,HH_02_RA) %>%        # Group by pop_groups
  summarise(
    var_name = "SDG 8.3.1",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(employed), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(employed, na.rm = TRUE),         # Weighted total count
    job_nature_total = survey_total(job_nature, na.rm = TRUE),   # Total for edu_primary
    employed_total = survey_total(employed, na.rm = TRUE)    # Total for age_primary
  ) %>%
  mutate(
    mean_value = round(job_nature_total / employed_total, 4)  # Calculate the mean value
  )




###Chart for the above table


ggplot(C080302_AGD, aes(x = HH_02_RA, y = mean_value, fill = HH_02_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of informal employment in total employment",
    x = "Gender ",
    y = "Proportion of Informal employment in total employment",
    fill = "Gender"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )
```
## 8.5.1 SDG Indicator

**Average hourly earnings of employees, by sex, age, occupation and persons with disabilities**

Indicator Code: C080501

This indicator provides information on the mean hourly earnings from paid employment of employees by sex, occupation, age, and disability status.

Earnings are a key aspect of quality of employment and living conditions. Information on hourly earnings disaggregated by various classifications (sex, age, occupation, disability status) provide some indication of the extent to which pay equality is respected or achieved.

| Standard Questions                                                                           |
|:--------------------------------------------------------------------------------------------:|
| EMP10_15a, EMP10_15, EMP10_16, EMP10_17, EMP10_18, EMP10_19_amount, EMP10_19_currency        |

**Unit of measure:**
Percent (%)

**Numerator:** hourly earning of each employee x hours worked by each employee

**Denominator:** Total number of hours worked by all employees

**Dataset:** RA_adult

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-08-05-01.docx&wdOrigin=BROWSELINK)

```{r}
table(RA_adult$EMP10_15a) #In your main job, are you paid for time spent on the job or for the completion of specific tasks?
summary(RA_adult$EMP10_15) #How many weeks per month do you usually work in this main job?
summary(RA_adult$EMP10_16) #How many days per week do you usually work in this main job?
summary(RA_adult$EMP10_17) #How many hours per day do you usually work at this main job?
table(RA_adult$EMP10_18) #What is the easiest way for you to report how much you earn in this main job, per hour, day, week, every two weeks, or month, year?
summary(RA_adult$EMP10_19) #What is your earnings per ${EMP10_18_label2}? - EMP10_19_amount, EMP10_19_currency
summary(RA_adult$EMP10_19a_note) #Please think about the last task you completed at your main job. How much did you earn for that task?  - EMP10_19a_amount, EMP10_19a_currency
table(RA_adult$EMP10_19b) #What is the easiest way for you to report how much time you spent to complete this task? In hours, days, weeks or months?
summary(RA_adult$EMP10_19c) #Approximately, how much time did you spend to complete this task?
```

```{r}
#Step 1: Calculate hourly earnings
RA_adult <- RA_adult %>%
  mutate(hourly_pay = case_when(
    # Payment frequency 1: Amount is hourly (no division needed)
    EMP10_15a %in% c(1, 3) & EMP10_18 == 1 & (EMP10_19_amount != 999999 & EMP10_19_amount != 999998) ~ EMP10_19_amount, 

    # Payment frequency 2: Paid per day, so divide by hours per day (EMP10_17) if > 0
    EMP10_15a %in% c(1, 3) & EMP10_18 == 2 & EMP10_17 > 0 & (EMP10_19_amount != 999999 & EMP10_19_amount != 999998)~ EMP10_19_amount / EMP10_17,

    # Payment frequency 3: Paid per week, so divide by (days per week * hours per day) if > 0
    EMP10_15a %in% c(1, 3) & EMP10_18 == 3 & EMP10_16 > 0 & EMP10_17 > 0 & (EMP10_19_amount != 999999 & EMP10_19_amount != 999998) ~ EMP10_19_amount / (EMP10_16 * EMP10_17),

    # Payment frequency 4: Paid per every two weeks? (or similar), divide by (2 * EMP10_16 * EMP10_17) if > 0
    EMP10_15a %in% c(1, 3) & EMP10_18 == 4 & EMP10_16 > 0 & EMP10_17 > 0  & (EMP10_19_amount != 999999 & EMP10_19_amount != 999998) ~ EMP10_19_amount / (2 * EMP10_16 * EMP10_17),

    # Payment frequency 5: Paid per month, so divide by (weeks per month * days per week * hours per day) if > 0
    EMP10_15a %in% c(1, 3) & EMP10_18 == 5 & EMP10_15 > 0 & EMP10_16 > 0 & EMP10_17 > 0 & (EMP10_19_amount != 999999 & EMP10_19_amount != 999998) ~ EMP10_19_amount / (EMP10_15 * EMP10_16 * EMP10_17),

    # Payment frequency 6: Paid per year, assuming work 12 months per year; check all denominators > 0
    EMP10_15a %in% c(1, 3) & EMP10_18 == 6 & EMP10_15 > 0 & EMP10_16 > 0 & EMP10_17 > 0 & (EMP10_19_amount != 999999 & EMP10_19_amount != 999998) ~ EMP10_19_amount / (12 * EMP10_15 * EMP10_16 * EMP10_17),

    # Payment frequency 7: Not paid in salary/wage/cash
    EMP10_15a %in% c(1, 3) & EMP10_18 == 7 ~ NA_real_,

    # Task-based payment cases:
    EMP10_15a == 2 & EMP10_19b == 1 & EMP10_19c > 0 & (EMP10_19a_amount != 999999 & EMP10_19a_amount != 999998) ~ EMP10_19a_amount / EMP10_19c,
    EMP10_15a == 2 & EMP10_19b == 2 & EMP10_19c > 0 & EMP10_17 > 0 & (EMP10_19a_amount != 999999 & EMP10_19a_amount != 999998) ~ EMP10_19a_amount / (EMP10_19c * EMP10_17),
    EMP10_15a == 2 & EMP10_19b == 3 & EMP10_19c > 0 & EMP10_16 > 0 & EMP10_17 > 0 & (EMP10_19a_amount != 999999 & EMP10_19a_amount != 999998) ~ EMP10_19a_amount / (EMP10_19c * EMP10_16 * EMP10_17),
    EMP10_15a == 2 & EMP10_19b == 4 & EMP10_19c > 0 & EMP10_15 > 0 & EMP10_16 > 0 & EMP10_17 > 0 & (EMP10_19a_amount != 999999 & EMP10_19a_amount != 999998)  ~ EMP10_19a_amount / (EMP10_19c * EMP10_15 * EMP10_16 * EMP10_17),
    
    # Default case if none of the conditions are met
    TRUE ~ NA_real_
  ))
RA_adult <- RA_adult %>%
  mutate(hourly_pay = as.integer(hourly_pay))

```

```{r}
# Calculate the average of hourly_pay, ignoring NAs
average_hourly_pay <- RA_adult %>%
  summarise(avg_hourly_pay = mean(hourly_pay, na.rm = TRUE)) %>%
  pull(avg_hourly_pay)

# Print the result
cat("The average hourly pay is:", format(round(average_hourly_pay, 2), nsmall = 2), "\n")

```

### Figure for SDG 8.5.2 by Population Groups

```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

C080501 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(hourly_pay)) %>%  # Exclude missing hourly pay values
  group_by(Intro_07) %>%          # Group by your population group variable
  summarise(
    avg_hourly_pay = survey_mean(hourly_pay, na.rm = TRUE),  # Calculate weighted mean
    .groups = "drop"
  )

# Create the bar chart
ggplot(C080501, aes(x = Intro_07, y = avg_hourly_pay, fill = Intro_07)) +
  geom_bar(stat = "identity", width = 0.7, position = "dodge") +
  geom_text(aes(label = sprintf("%.2f", avg_hourly_pay)),
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +
  labs(
    title = "Average Hourly Earnings by Population Group (Weighted)",
    x = "Population Group",
    y = "Average Hourly Earnings"
  ) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, max(C080501$avg_hourly_pay) * 1.2)) +
  scale_fill_unhcr_d() +   # Use UNHCR color palette if available
  theme_unhcr() +          # Apply UNHCR theme if available
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

#ILGI: Below I removed the outliers and run the table/chart again as a test and the result seems more plausable. Once you review this indicator lets remove this test table and chart, however data for PAK and CAM should be checked and cleaned before running this indicator (if needed). 
```{r}

lower_percentile <- quantile(RA_adult$hourly_pay, 0.01, na.rm = TRUE)
upper_percentile <- quantile(RA_adult$hourly_pay, 0.99, na.rm = TRUE)

RA_adult <- RA_adult %>%
  mutate(percentile_outlier = ifelse(hourly_pay < lower_percentile | hourly_pay > upper_percentile, TRUE, FALSE))

# Exclude outliers and calculate weighted averages
C080501_test <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(hourly_pay)) %>%  # Exclude missing hourly pay values
  mutate(
    lower_percentile = survey_quantile(hourly_pay, 0.01, na.rm = TRUE),
    upper_percentile = survey_quantile(hourly_pay, 0.99, na.rm = TRUE)
  ) %>%
  filter(hourly_pay >= lower_percentile, hourly_pay <= upper_percentile) %>%  # Exclude outliers
  group_by(Intro_07) %>%          # Group by your population group variable
  summarise(
    avg_hourly_pay = survey_mean(hourly_pay, na.rm = TRUE),  # Calculate weighted mean
    .groups = "drop"
  )

# Create the bar chart
ggplot(C080501_test, aes(x = Intro_07, y = avg_hourly_pay, fill = Intro_07)) +
  geom_bar(stat = "identity", width = 0.7, position = "dodge") +
  geom_text(aes(label = sprintf("%.2f", avg_hourly_pay)),
            position = position_dodge(width = 0.7), vjust = -0.5, size = 3) +
  labs(
    title = "Average Hourly Earnings by Population Group (Weighted, Excluding Outliers)",
    x = "Population Group",
    y = "Average Hourly Earnings"
  ) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, max(C080501_test$avg_hourly_pay) * 1.2)) +
  scale_fill_unhcr_d() +   # Use UNHCR color palette if available
  theme_unhcr() +          # Apply UNHCR theme if available
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
### Figure for SDG 8.5.2 by Gender, Disability and Population Groups

```{r}
FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

C080501_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(hourly_pay) & !is.na(disability_RA) & !is.na(HH_02_RA)) %>%  # Exclude missing hourly pay values
  group_by(Intro_07, disability_RA,HH_02_RA ) %>%          # Group by your population group variable
  summarise(
    avg_hourly_pay = survey_mean(hourly_pay, na.rm = TRUE),  # Calculate weighted mean
    .groups = "drop"
  )

ggplot(C080501_AGD, aes(x = HH_02_RA, y = avg_hourly_pay, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", avg_hourly_pay)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +
  facet_wrap(~ Intro_07) +
  labs(
    title = "Average Hourly Earnings by Gender, Disability, and Population Groups",
    x = "Gender",
    y = "Average Hourly Earnings",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +
  scale_y_continuous(limits = c(0, max(C080501_AGD$avg_hourly_pay) * 1.2), expand = c(0, 0)) +
  theme_unhcr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
### Figure for SDG 8.5.2 by Gender, Disability and Population Groups - Treating outliers 

```{r}
FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

C080501_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(hourly_pay) & !is.na(disability_RA) & !is.na(HH_02_RA)) %>%  # Exclude missing hourly pay values
  mutate(
    lower_percentile = survey_quantile(hourly_pay, 0.01, na.rm = TRUE),
    upper_percentile = survey_quantile(hourly_pay, 0.99, na.rm = TRUE)
  ) %>%
  filter(hourly_pay >= lower_percentile, hourly_pay <= upper_percentile) %>%  # Exclude outliers
  group_by(Intro_07, disability_RA,HH_02_RA ) %>%          # Group by your population group variable
  summarise(
    avg_hourly_pay = survey_mean(hourly_pay, na.rm = TRUE),  # Calculate weighted mean
    .groups = "drop"
  )

ggplot(C080501_AGD, aes(x = HH_02_RA, y = avg_hourly_pay, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", avg_hourly_pay)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +
  facet_wrap(~ Intro_07) +
  labs(
    title = "Average Hourly Earnings by Gender, Disability, and Population Groups",
    x = "Gender",
    y = "Average Hourly Earnings",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +
  scale_y_continuous(limits = c(0, max(C080501_AGD$avg_hourly_pay) * 1.2), expand = c(0, 0)) +
  theme_unhcr() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```




## 8.5.2 SDG Indicator

**8.5.2 Unemployment rate, by sex, age and persons with disabilities**

Indicator Code: C080502

The unemployment rate conveys the percentage of persons in the labour force who are unemployed.

| Standard Questions                                                                           |
|:--------------------------------------------------------------------------------------------:|
| EMP01, EMP02, EMP03, EMP04, EMP05, EMP06a, EMP06b, EMP06c, EMP06d, EMP25a, EMP25aa, EMP29    |

**Unit of measure:**
Percent (%)

**Numerator:** Number of individuals in the labour force who are unemployed

**Denominator:** Total number of individuals in the labour force

**Dataset:** RA_adult

**Concepts**:

*Unemployed persons* are defined as all those of working age (usually aged 15 and above) who were not in employment, carried out activities to seek employment during a specified recent period and were currently available to take up employment given a job opportunity.

*Persons in employment* are defined as all those of working age (usually aged 15 and above) who, during a short reference period such as one week or one day, were engaged in any activity to produce goods or provide services for pay or profit. 

*The labour force* corresponds to the sum of persons in employment and in unemployment.

*Working age* population is the population above the legal working age. Often it is defined as all persons aged 15 or older, but this can vary from country to country based on national laws and practices. 

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-08-05-02.docx&wdOrigin=BROWSELINK)
2. [Labour Force Statistics](https://ilostat.ilo.org/methods/concepts-and-definitions/description-labour-force-statistics/)

```{r, eval=FALSE}
table(RA_adult$EMP01) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you work for someone else for pay, for one or more hours?
table(RA_adult$EMP02) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you run or do any kind of business, farming or other activity to make money?
table(RA_adult$EMP03) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you help in a family business or farm?
table(RA_adult$EMP04) #Even though you did not work, during the past 7 days, did you have a paid job from which you were temporarily absent?
table(RA_adult$EMP05) #Even though you did not work, during the past 7 days, did you have a business or a helper job in a family business/farm from which you were temporarily absent?
table(RA_adult$EMP06a) #During the past 7 days, did you do any work in farming or rearing farm animals, fishing or fish farming, or none of these?
table(RA_adult$EMP06b) #Was this work that you mentioned in farming or rearing farming animals, fishing or fish farming, or none of these?
table(RA_adult$EMP06c) #Thinking about this work, are the products intended only for sale, mainly for sale, only for family use, or mainly for family use?
table(RA_adult$EMP25a) #During the past 30 days, did you do anything to find a paid job?
table(RA_adult$EMP25aa)#During the past 30 days, did you do anything to start a business?
table(RA_adult$EMP29)  #Could you start working within the next 14 days if you were offered a job?
```

```{r, eval=FALSE}
#Step 1: Determine who is employed based on various conditions 
RA_adult <- RA_adult %>%
  mutate(employed = case_when(
    EMP01 == 1  ~ 1,  # Paid employment - employees
    EMP02 == 1 & EMP06b == 3~ 1,  # Self-employment
    EMP03 == 1 & EMP06b == 3~ 1,  # Unpaid contributing family workers
    EMP04 == 1  ~ 1,  # Absent but still employed
    EMP05 == 1 & EMP06a == 3~ 1,  # Absent but self-employed
    EMP02 == 1 & EMP06b %in% c(1, 2) & EMP06c %in% c(1, 2) ~ 1,  # Farming/rearing/fishing for sale
    EMP05 == 1 & EMP06a %in% c(1, 2) & EMP06c %in% c(1, 2) ~ 1,  # Absent but farming for sale
    TRUE ~ 0  # Not employed
  ))
```

```{r, eval=FALSE}
#Step 2: Define unemployed: those not employed but actively looking for work and available to carry out activities
RA_adult <- RA_adult %>%
  mutate(unemployed = case_when(
    (employed == 0 & (EMP25a == 1 | EMP25aa == 1) & EMP29 == 1) ~ 1,  # Actively looking for work
    TRUE ~ 0  # Not unemployed if not actively looking or employed
  ))
```

```{r, eval=FALSE}
#Step 3: Define labour force: anyone employed or unemployed
RA_adult <- RA_adult %>%
  mutate(labour_force = case_when(
    (employed == 1 | unemployed == 1) ~ 1,  # Employed or actively seeking work
    TRUE ~ 0  # Not in labour force
  ))
```

```{r, eval=FALSE}
#Step 4: Outcome - Unemployment rate
RA_adult <- RA_adult %>%
  mutate(C080502 = case_when(
    employed == 1 & labour_force == 1 ~ 0,  # If employed, outcome is 2 (not unemployed)
    unemployed == 1 & labour_force == 1 ~ 1,  # If unemployed, outcome is 1
    TRUE ~ NA_real_  # Catch-all for cases not in the labor force or with missing data
  ))
```

```{r, eval=FALSE}
RA_adult <- RA_adult %>%
   mutate(C080502 = labelled(C080502,
                                labels = c(
                                  "Unemployed" = 1,  # Label for Yes
                                  "Not unemployed" = 0   # Label for No
                                ),
                                label = "Proportion of people (working age) who are unemployed"))
```


### Figure for SDG 8.5.2 by Population Groups

```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C080502 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG8.5.2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C080502, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C080502, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 8.5.2",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```


### Figure for SDG 8.5.2 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C080502_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG8_5_2",                # Name of the variable
    num_obs_uw = survey_total(!is.na(C080502), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C080502, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

## figure

ggplot(C080502_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of people (working age) who are unemployed",
    x = "Gender ",
    y = "Proportion of people who are unemployed",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )
```
```{r}

```

## 8.6.1 SDG Indicator 

**8.6.1 Proportion of youth (aged 15–24 years) not in education, employment or training**
Indicator Code: C080601

This indicator conveys the proportion of youth (aged 15-24 years) not in education, employment or training (also known as "the youth NEET rate").

| Standard Questions                                                                                                          |
|:---------------------------------------------------------------------------------------------------------------------------:|
| EMP01, EMP02, EMP03, EMP04, EMP05, EMP06a, EMP06b, EMP06c,EMP25a,EMP25aa,EMP29, HH_Educ03, HH_Educ02a, EducR08              |

**Unit of measure:**
Percent (%)

**Numerator**: (Unemployed youth +Youth outside the labour force) - (Unemployed youth in educator or training + Youth outside the labor force in education or training)

**Denominator**: Total number of youth (aged 15-24 years)

**Concepts**: 

*Youth* is defined as all persons between the ages of 15 and 24 (inclusive).

*Non-formal education*, like formal education is defined in ISCED as education that is institutionalized, intentional and planned by an education provider but is considered an addition, alternative and/or a complement to formal education. Informal learning is defined in ISCED as forms of learning that are intentional or deliberate, but not institutionalized.For the purposes of this indicator, persons will be considered in education if they are in formal or non-formal education, as described above, but excluding informal learning.

*Employment* is defined as all persons of working age who, during a short reference period (one week), were engaged in any activity to produce goods or provide services for pay or profit.Employment is defined as all persons of working age who, during a short reference period (one week), were engaged in any activity to produce goods or provide services for pay or profit.
For the purpose of this indicator, persons are considered to be in training if they are in a non-academic learning activity through which they acquire specific skills intended for vocational or technical jobs.

*The labour force* is the sum of persons in employment plus persons in unemployment. Together these two groups of the population represent the current supply of labour for the production of goods and services taking place in a country through market transactions in exchange for remuneration.

*Working age* population is the population above the legal working. Often it is defined as all persons aged 15 or older, but this can vary from country to country based on national laws and practices. 

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-08-06-01.docx&wdOrigin=BROWSELINK)
2. [Labour Force Statistics](https://ilostat.ilo.org/methods/concepts-and-definitions/description-labour-force-statistics/)
```{r, eval=FALSE}
table(RA_adult$EMP01) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you work for someone else for pay, for one or more hours?
table(RA_adul$EMP02) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you run or do any kind of business, farming or other activity to make money?
table(RA_adul$EMP03) #During the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, did you help in a family business or farm?
table(RA_adul$EMP04) #Even though you did not work, during the past 7 days, did you have a paid job from which you were temporarily absent?
table(RA_adul$EMP05) #Even though you did not work, during the past 7 days, did you have a business or a helper job in a family business/farm from which you were temporarily absent?
table(RA_adul$EMP06a) #During the past 7 days, did you do any work in farming or rearing farm animals, fishing or fish farming, or none of these?
table(RA_adul$EMP06b) #Was this work that you mentioned in farming or rearing farming animals, fishing or fish farming, or none of these?
table(RA_adul$EMP06c) #Thinking about this work, are the products intended only for sale, mainly for sale, only for family use, or mainly for family use?
table(RA_adul$EMP06d) #How many hours did you spend doing this work during the past 7 days?
table(RA_adul$EMP25a) #During the past 30 days, did you do anything to find a paid job?
table(RA_adul$EMP25aa)#During the past 30 days, did you do anything to start a business?
table(RA_adul$EMP29)  #Could you start working within the next 14 days if you were offered a job?
table(RA_adul$EducR08)#Have you ever completed an apprenticeship?
table(RA_adul$educ_now) # Are you currently going to school?  If it is school holiday between two school years, tell us about the last school year.Do not include kindergarten or preschool.
```
ILGI: *Note: Apart from the above variables, this indicator should also include other forms of training (not only apprenticeship). With questions posted in FDS, we are unable to determine if an individual is currently participating in training other than apprenticeship. 
Check the entire calculation with Ilgi. 

```{r, eval=FALSE}
#Step 1: Create a variable identifying unemployed youth
RA_adult <- RA_adult %>%
  mutate(employed_youth = case_when(
    EMP01 == 1 & between(age_selected, 15, 24) ~ 1,  # Paid employment - employees
    EMP02 == 1 & EMP06b == 3 & between(age_selected, 15, 24) ~ 1,  # Self-employment
    EMP03 == 1 & EMP06b == 3 & between(age_selected, 15, 24) ~ 1,  # Unpaid contributing family workers
    EMP04 == 1 & between(age_selected, 15, 24) ~ 1,  # Absent but still employed
    EMP05 == 1 & EMP06a == 3 & between(age_selected, 15, 24) ~ 1,  # Absent but self-employed
    EMP02 == 1 & EMP06b %in% c(1, 2) & EMP06c %in% c(1, 2) & between(age_selected, 15, 24) ~ 1,  # Farming/rearing/fishing for sale
    EMP05 == 1 & EMP06a %in% c(1, 2) & EMP06c %in% c(1, 2) & between(age_selected, 15, 24) ~ 1,  # Absent but farming for sale
    between(age_selected, 15, 24) ~ 0,  # If working age but none of the above, mark as not employed
    TRUE ~ NA_real_  # Set to NA for those not classified as youth
  ))
```

```{r, eval=FALSE}
#Step 2: Define unemployed and those outside of the labour force
RA_adult <- RA_adult %>%
  mutate(unemployed_youth = case_when(
    (employed_youth == 0 & (EMP25a == 1 | EMP25aa == 1) & EMP29 == 1) & between(age_selected, 15, 24) ~ 1,  # Actively looking for work - unemployed 
    employed_youth == 0 & EMP29 != 1 & between(age_selected, 15, 24) ~ 0,  # Outside of labour force
    TRUE ~ NA_real_  
  ))
```

```{r, eval=FALSE}
#Step 3: Create a variable identifying youth in education 
RA_adult <- RA_adult %>%
  mutate(youth_education = case_when(
    (between(age_selected, 15, 24) & educ_now == 1) ~ 1,  # Currently in education
    (between(age_selected, 15, 24) & educ_now == 2) ~ 0,  # Currently not in education
    TRUE ~ NA_real_  
  ))
```

```{r, eval=FALSE}
#Step 4: Create a variable identifying youth doing currently in training (apprenticeship). 
RA_adult <- RA_adult %>%
  mutate(youth_training = case_when(
    (between(age_selected, 15, 24) & EducR08 == 3) ~ 1,  # Currently in training
    (between(age_selected, 15, 24) & EducR08 == 1 | EducR08 == 2) ~ 0,  # Currently not in training
    TRUE ~ NA_real_  
  ))
```


```{r, eval=FALSE}
#Step 5: Define the numerator
RA_adult <- RA_adult %>%
  mutate(num_C080601 = case_when(
    unemployed_youth %in% c(0,1) & youth_training == 0 & youth_education == 0 ~ 1, #Youth not in employment, education or training 
    TRUE ~ 0))
    
```
```{r, eval=FALSE}
#Step 7: Define the denominator 
RA_adult <- RA_adult %>%
  mutate(denominator_age = case_when(
    (age_selected >= 15 & age_selected <= 24) ~ 1,
     TRUE ~ 0))
```


### Figure for SDG 8.6.1 by Population Groups

```{r, eval=FALSE}

###Results of the indicator table

FDS_PAK_2024_RA_adult <- RA_adult  %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

##Table 

C080601 <- FDS_PAK_2024_RA_adult  %>%
  filter(!is.na(Intro_07)) %>%         # Exclude if pop_groups is NA
  group_by(Intro_07) %>%                  # Group by pop_groups
  summarise(
    var_name = "impact3_2a",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(denominator_age), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(denominator_age, na.rm = TRUE),         # Weighted total count
    num_C080601_total = survey_total(num_C080601, na.rm = TRUE),   # Total for num_C080601
    denominator_age_total = survey_total(denominator_age, na.rm = TRUE)    # Total for denominator_age
  ) %>%
  mutate(
    mean_value = round(num_C080601_total / denominator_age_total, 4)  # Calculate the mean value
  )


##Figure 


ggplot(C080601, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Corrected the misplaced `width`
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(width = 0.7)) +  # Correct text positioning
  scale_y_continuous(limits = c(0, 1.2), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 8.6.1",
    x = "Population Groups",
    y = "Mean Value"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  theme_unhcr() +         # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```
### Figure for SDG 8.6.1 by Gender, Disability and Population Groups


```{r, eval=FALSE}

###Table with gender and disability included for the chart

C080601_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07) & !is.na(disability_RA) & !is.na(HH_02_RA)) %>%                     # Exclude if pop_groups is NA
  group_by(Intro_07,disability_RA,HH_02_RA) %>%        # Group by pop_groups
  summarise(
    var_name = "SDG 8.6.1",                        # Name of the variable
    num_obs_uw = survey_total(!is.na(denominator_age), na.rm = TRUE),  # Unweighted total count
    denominator = survey_total(denominator_age, na.rm = TRUE),         # Weighted total count
    num_C080601_total = survey_total(num_C080601, na.rm = TRUE),   # Total for num_C080601
    denominator_age_total = survey_total(denominator_age, na.rm = TRUE)    # Total for denominator_age
  ) %>%
  mutate(
     mean_value = round(num_C080601_total / denominator_age_total, 4)   # Calculate the mean value
  )

###Chart for the above table

ggplot(C080601_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of youth (aged 15–24 years) not in education, employment or training",
    x = "Gender ",
    y = "Proportion of youth",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )





```

## 8.7.1 SDG Indicator

**8.7.1 Proportion and number of children aged 5–17 years engaged in child labour, by sex and age**
Indicator Code: C080701

The number of children engaged in child labour corresponds to the number of children reported to be in child labour during the reference period (usually the week prior to the survey). The proportion of children in child labour is calculated as the number of children in child labour divided by the total number of children in the population. For the purposes of this indicator, children include all persons aged 5 to 17.

| Standard Questions                                                                                                          |
|:---------------------------------------------------------------------------------------------------------------------------:|
| CL01_1, CL01_2, CL01_3, CL01_4, CL02, CL08_1, CL08_2, CL08_3, CL08_4, CL08_5, CL08_6, CL08_7, CL08_8, CL08_9, CL08_10, CL09 |

**Unit of measure:**
Percent (%)

**Numerator**: Number of children aged 5-17 reported in child labour during the week prior to the survey

**Denominator**: Total number of children aged 5-17 in the population

**Concepts**: 

*Child labour* is work that children should not be doing because (a) they are too young or (b) is likely to harm their health, safety or morals, due to its nature or the conditions in which it is carried out.

In accordance with the International Conferences of Labour Statisticians (ICLS) resolutions1, child labour can be measured on the basis of the production boundary set by the United Nations System of National Accounts (UN SNA) or on the basis of the general production boundary. The former limits the frame of reference to economic activity, while the latter extends it to include both economic activity and unpaid household services, that is, the production of domestic and personal services by a household member for consumption within their own household, commonly called “household chores". 
Following from this, two indicators are used for measuring child labour for the purpose of SDG reporting, the first based on the production boundary set by the UN SNA and the second based on the general production boundary.

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-08-07-01.docx&wdOrigin=BROWSELINK)
2. [International Conferences of Labour Statisticians](https://ilostat.ilo.org/about/standards/icls/icls-documents/)


*1st Indicator* - Proportion and number of children aged 5-17 years engaged in economic activities at or above age-specific hourly thresholds (SNA production boundary basis)
The following must be observed when calulating the indicator: 
Child labour for the 5 to 11 age range: children working for 1 hour or more per week in economic activity;

Child labour for the 12 to 14 age range: children working for 14 hours or more per week in economic activity;

Child labour for the 15 to 17 age range: children working for 43 hours or more per week in economic activity.

```{r, eval=FALSE}
table(main$CL01_1) #Did child do any work or help in a farm, food garden or looked after animals either for the household or someone else? For example, growing farm produce, harvesting, or feeding, grazing or milking animals?
table(main$CL01_2) #Did child help in a family business or a relative’s business with or without pay, or run ${proB} own business?
table(main$CL01_3) #Did child produce or sell articles, handicrafts, clothes, food or agricultural products?
table(main$CL01_4) #During the past 7 days, did child engage in any other activity in return for income in cash or in kind, even for only one hour?
summary(main$CL02) #During the past 7 days, about how many hours did child engage in his/her activities, in total?
```
```{r, eval=FALSE}
#Step 1: Create a variable identifying children who were engaged in any of the economic activities. 
main <- main %>%
  mutate(child_economic_activity = case_when(
   CL01_1 == 1 | CL01_2 == 1 | CL01_3 == 1 | CL01_4 == 1 ~ 1, #assign 1 if the child has been engaged in any activity
   CL01_1 == 2 & CL01_2 == 2 & CL01_3 == 2 & CL01_4 == 2 ~ 0, #assign 2 if the child has not been engaged in any activity
    TRUE ~ NA                # assign NA for all other cases 
  ))
```
```{r, eval=FALSE}

#Step 2: Create a variable identifying the children who have been exposed to child labor. That is engaged in an economic activity at or above age-specific hourly thresholds. 
main <- main %>%
  mutate(C080701a = case_when(
     #Condition for children aged 5-11: engaged in economic activity for at least 1 hour
     child_labor_age >= 5 & child_labor_age <= 11 & child_economic_activity == 1 & CL02 >= 1 ~ 1,
     #Condition for children aged 12-14: engaged in economic activity for at least 14 hours
     child_labor_age >= 12 & child_labor_age <= 14 & child_economic_activity == 1 & CL02 >= 14 ~ 1,
     #Condition for children aged 15-17: engaged in economic activity for at least 43 hours
     child_labor_age >= 15 & child_labor_age <= 17 & child_economic_activity == 1 & CL02 >= 43 ~ 1,
     TRUE ~ 0)) #Otherwise, classify as not engaged in child labor
```


```{r, eval=FALSE}
main <- main %>%
  mutate(C080701a = labelled(C080701a,
                             labels = c(
                               "Yes" = 1,  # Label for Yes
                               "No" = 0    # Label for No
                             ),
                             label = "Proportion of children aged 5-17 years engaged in economic activities at or above age-specific hourly thresholds"))
```


```{r, eval=FALSE}
table(main$C080701a)
```


### Figure for SDG 8.7.1a by Population Groups

```{r, eval=FALSE}
###Table standard 

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C080701a <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG8.7.1a",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C080701a, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C080701a, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 8.7.1a",
    subtitle = "Proportion of children aged 5-17 years engaged in economic activities at or above age-specific hourly thresholds",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```


*2nd Indicator* - Proportion and number of children aged 5-17 years engaged in economic activities and household chores at or above age-specific hourly thresholds (general production boundary basis):

Child labour for the 5 to 11 age range: children working for 1 hour or more per week in economic activity and/or involved in unpaid household services for 21 hours or more per week;

Child labour for the 12 to 14 age range: children working for 14 hours or more per week in economic activity and/or involved in unpaid household services for 21 hours or more per week;

Child labour for the 15 to 17 age range: children working for 43 hours or more per week in economic activity. (no threshold for unpaid household services)

For the calculation of the 2nd indicator, we will use the calculations from the 1st indicator and the below additional calculations for unpaid household services. 

```{r, eval=FALSE}
table(main$CL01_1) #Did child do any work or help in a farm, food garden or looked after animals either for the household or someone else? For example, growing farm produce, harvesting, or feeding, grazing or milking animals?
table(main$CL01_2) #Did child help in a family business or a relative’s business with or without pay, or run ${proB} own business?
table(main$CL01_3) #Did child produce or sell articles, handicrafts, clothes, food or agricultural products?
table(main$CL01_4) #During the past 7 days, did child engage in any other activity in return for income in cash or in kind, even for only one hour?
summary(main$CL02) #During the past 7 days, about how many hours did child engage in his/her activities, in total?
#During the past 7 days, did ${childsampled} do any of the following for this household?
table(main$CL08_1) #Shopping for the household?
table(main$CL08_2) #Cooking?
table(main$CL08_3) #Washing dishes or cleaning around the house?
table(main$CL08_4) #Washing clothes?
table(main$CL08_5) #Caring for children?
table(main$CL08_6) #Caring for someone old or sick?
table(main$CL08_8) #Fetching water?
table(main$CL08_9) #Collecting firewood?
table(main$CL08_10)#Other household tasks?
summary(main$CL09) # In the past 7 days, from [the same week day as the day of the interview] last week up to yesterday, about how many hours did CHILD engage in his/her activity(ies), in total?
```

```{r, eval=FALSE}
#Step 1: Create a variable identifying children who were engaged in any of the economic activities - variable created under the calculations for the 1st indicator - variable name: "child_economic_activity". 
```
```{r, eval=FALSE}
#Step 2: Create a variable identifying children who were engaged in household chores
main <- main %>%
  mutate(child_household_chores = case_when(
   CL08_1 == 1 | CL08_2 == 1 | CL08_3 == 1 | CL08_4 == 1 | CL08_5 == 1 | CL08_6 == 1 | CL08_8 == 1 | CL08_9 == 1 | CL08_10 == 1 ~ 1, #assign 1 if the child has been engaged in any household chore
   CL08_1 == 2 & CL08_2 == 2 & CL08_3 == 2 & CL08_4 == 2 & CL08_5 == 2 & CL08_6 == 2 & CL08_6 == 2 & CL08_8 == 2 & CL08_9 == 2 & CL08_10 == 2 ~ 0, #assign 2 if the child has not been engaged in any household chore
    TRUE ~ NA                # assign NA for all other cases 
  ))
```
```{r, eval=FALSE}

#Step 2: Create a variable identifying the children who have been engaged in an economic activity at or above age-specific hourly thresholds. 
main <- main %>%
  mutate(child_labor_economic_activity  = case_when(
    # Condition for children aged 5-11: engaged in economic activity for at least 1 hour
    child_labor_age >= 5 & child_labor_age <= 11 & child_economic_activity == 1 & CL02 >= 1 ~ 1,
    
    # Condition for children aged 12-14: engaged in economic activity for at least 14 hours
    child_labor_age >= 12 & child_labor_age <= 14 & child_economic_activity == 1 & CL02 >= 14 ~ 1,
    
    # Condition for children aged 15-17: engaged in economic activity for at least 43 hours
    child_labor_age >= 15 & child_labor_age <= 17 & child_economic_activity == 1 & CL02 >= 43 ~ 1,
    
    # Otherwise, classify as not engaged economic activity at or above age-specific hourly thresholds.
    TRUE ~ 0
  ))
```

```{r, eval=FALSE}
#Step 3: Create a variable identifying the children who have been engaged in household chores at or above age-specific hourly thresholds.
main <- main %>%
mutate(child_labor_household_chores  = case_when(
    # Condition for children aged 5-11: engaged in household chores for at least 21 hours
   child_labor_age >= 5 & child_labor_age <= 11 & child_household_chores == 1 & CL09 >= 21 ~ 1,
    
    # Condition for children aged 12-14: engaged in household chores for at least 21 hours
    child_labor_age >= 12 & child_labor_age <= 14 & child_household_chores == 1 & CL09 >= 21 ~ 1,
    
    # Condition for children aged 15-17: engaged in household chores
    child_labor_age >= 15 & child_labor_age <= 17 & child_household_chores == 1 & CL09 >= 0 ~ 1,
    
    # Otherwise, classify as not engaged in household chores at or above age-specific hourly thresholds.
    TRUE ~ 0
  ))
```
```{r, eval=FALSE}
#Step 4: Combine both categories to compute the indicator
main <- main %>%
  mutate(C080701b = case_when(child_labor_economic_activity == 1 | child_labor_household_chores == 1 ~ 1,
  child_labor_economic_activity == 0 & child_labor_household_chores == 0 ~ 0 ))
   
```
```{r, eval=FALSE}
main <- main %>%
  mutate(C080701b = labelled(C080701b,
                             labels = c(
                               "Yes" = 1,  # Label for Yes
                               "No" = 0    # Label for No
                             ),
                             label = "Proportion of children aged 5-17 years engaged in economic activities and household chores at or above age-specific hourly thresholds"))

```
```{r, eval=FALSE}
table(main$C080701b)
```

### Figure for SDG 8.7.1b by Population Groups

```{r, eval=FALSE}
###Table standard 

FDS_PAK_2024_main <- main %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C080701b <- FDS_PAK_2024_main %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG8.7.1b",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C080701b, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C080701b, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 8.7.1b",
    subtitle = "Proportion of children aged 5-17 years engaged in economic activities and household chores at or above age-specific hourly thresholds",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```


## 8.10.2 SDG Indicator

**8.10.2 Proportion of adults (15 years and older) with an account at a bank or other financial institution or with a mobile-money-service provider**

Indicator Code: C081002

The percentage of adults (ages 15+) who report having an account (by themselves or together with someone else) at a bank or another type of financial institution or personally using a mobile money service in the past 12 months.

| Standard Questions           |
|:----------------------------:|
| FI01, FI02, FI03, FI10       |

**Unit of measure:**
Percent (%)

**Numerator**: Number of individuals 15 or above having a personal mobile or bank account

**Denominator**: Total number of individuals 15 or above

**Dataset:** RA_adult

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-08-10-02.docx&wdOrigin=BROWSELINK)

```{r, eval=FALSE}
table(RA_adult$FI01) #Do you, either by yourself or together with someone else, currently have an account at a bank or another type of formal financial institution in the host country?
table(RA_adult$FI02) #Do you, personally, have a debit card in the host country?
table(RA_adult$FI03) #Do you, personally, have a credit card in the host country?
table(RA_adult$FI10) #In the past 12 months, have you personally used a mobile phone to make payments, buy things, or to send or receive money using a service such as [country specific example]?
```

```{r, eval=FALSE}
RA_adult <- RA_adult %>%
  mutate(C081002 = case_when(
   FI01 == 1 | FI02 == 1 | FI03 == 1 | FI10 == 1 ~ 1,
   FI01 == 2 & FI02 == 2 & FI03 == 2 & FI10 %in% c(2,3) ~ 0,
    TRUE ~ NA                # For individuals under 18 and all other cases, assigns NA
  ))

```
```{r, eval=FALSE}
RA_adult <- RA_adult %>%
   mutate(C081002 = labelled(C081002,
                                labels = c(
                                  "Yes" = 1,  # Label for Yes
                                  "No" = 0    # Label for No
                                ),
                                label = "Proportion of people above with an account at a bank or other financial institution or with a mobile-money-service provider"
  ))
```
```{r, eval=FALSE}
table(RA_adult$C081002)
```

### Figure for SDG 8.10.2 by Population Groups

```{r, eval=FALSE}
###Table standard 

FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C081002 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG8.10.2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C081002, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C081002, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 8.10.2",
    subtitle = "Proportion of people above with an account at a bank or other financial institution or with a mobile-money-service provider",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 8.10.1 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C081002_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG 8.10.2",                # Name of the variable
    num_obs_uw = survey_total(!is.na(C081002), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C081002, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )

## figure

ggplot(C081002_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of people above with an account at a bank or other financial institution or with a mobile-money-service provider",
    x = "Gender ",
    y = "Proportion of people with an account",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )
```

## 10.3.1 SDG Indicator

**10.3.1 Proportion of population reporting having personally felt discriminated against or harassed in the previous 12 months on the basis of a ground of discrimination prohibited under international human rights law**

Indicator Code: C200204

This indicator is defined as the proportion of the population (adults) who self-report that they personally experienced discrimination or harassment during the last 12 months based on ground(s) prohibited by international human rights law (IHRL). IHRL refers to the body of international legal instruments aiming to promote and protect human rights, including the Universal Declaration of Human Rights (UDHR) and sub-sequent international human rights treaties adopted by the United Nations (UN).

The FDS discrimination module asks how often the respondent experiences discrimination in nines areas. It measures if the respondent has experienced at least one form of discrimination corresponding to the Everyday Discrimination Scale.

| Standard Questions                                                                    |
|:-------------------------------------------------------------------------------------:|
| DI01, DI01_01, DI01_02, DI01_03, DI01_04, DI01_05, DI01_06, DI01_07, DI01_08, DI01_09 |

**Unit of measure:**
Percent (%)

**Numerator**: Number of survey respondents who report experience of any form of discrimination or harassment during the last 12 months

**Denominator**: Total number of survey respondents 

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-10-03-01.docx&wdOrigin=BROWSELINK)
2. [Guidance Note for Implementation of Survey Module on SDG Indicator 16.b.1 & 10.3.1](https://www.ohchr.org/sites/default/files/Documents/Issues/HRIndicators/SDG_Indicator_16b1_10_3_1_Guidance_Note_.pdf)

```{r, eval=FALSE}
#In the past 12 month, in your day-to-day life in the host country, how often do any of the following things happen to you? Would you say  almost every day, at least once a week, a few times a month, a few times a year, less than once a year or never?:
table(RA_adult$DI01_01) #You are treated with less politeness than other people are.
table(RA_adult$DI01_02) #You are treated with less respect than other people are.
table(RA_adult$DI01_03) #You receive poorer service than other people at restaurants or stores.
table(RA_adult$DI01_04) #People act as if they think you are not smart.
table(RA_adult$DI01_05) #People act as if they are afraid of you.
table(RA_adult$DI01_06) #People act as if they think you are dishonest.
table(RA_adult$DI01_07) #People act as if they’re better than you are.
table(RA_adult$DI01_08) #You are called names or insulted.
table(RA_adult$DI01_09) #You are threatened or harassed.```
```
```{r, eval=FALSE}
RA_adult <- RA_adult %>%
  mutate(C200204 = case_when(
    # If any value is 1, 2, 3, 4, or 5, assign 1
    rowSums(across(c(DI01_01, DI01_02, DI01_03, DI01_04, 
                     DI01_05, DI01_06, DI01_07, DI01_08, DI01_09), ~ . %in% 1:5)) > 0 ~ 1,
    # If all values are 6, assign 2
    rowSums(across(c(DI01_01, DI01_02, DI01_03, DI01_04, 
                     DI01_05, DI01_06, DI01_07, DI01_08, DI01_09), ~ . == 6)) == 9 ~ 0,
    # If all values are 7, assign NA
    rowSums(across(c(DI01_01, DI01_02, DI01_03, DI01_04, 
                     DI01_05, DI01_06, DI01_07, DI01_08, DI01_09), ~ . == 7)) == 9 ~ NA_real_,
    TRUE ~ NA_real_
  )) %>%
  mutate(C200204 = labelled(
    C200204,
    labels = c(
      'Yes' = 1,
      'No' = 0
    ),
    label = "Proportion of population reporting having personally felt discriminated against or harassed in the previous 12 months on the basis of a ground of discrimination prohibited under international human rights law"
  ))

```
```{r, eval=FALSE}
table(RA_adult$C200204)
```

### Figure for SDG 10.3.1 by Population Group

```{r}

##Table by population groups

FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C200204 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG10_3_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C200204, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of outcome 16.b.1 by pop groups

ggplot(C200204, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 10.3.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```


### Figure for SDG10.3.1 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity
C200204_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG10_3_1",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(C200204), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C200204, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )



ggplot(C200204_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of population reporting having personally felt discriminated against or harassed in the previous 12 months.",
    x = "Gender ",
    y = "Those discriminated or harrased",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```


## 16.1.4 SDG Indicator

**16.1.4 Proportion of population that feel safe walking alone around the area they live after dark**

Indicator Code: C160105

This indicator refers to the proportion of the adult population who feel safe walking alone in their neighborhood after dark.

As per the SDG metadata guidance, the perception of safety is considered a subjective well being indicator. It affects the way in which human beings interact with their surroundings, their health, and consequently, their quality of life. Indicator 16.1.4 taps into the concept of ‘fear of crime’, which has been elicited in dozens of crime victimization surveys, and the standard formulation used here has been shown to be applicable in different cultural contexts. It is important to note that fear of crime is a phenomenon that is separate from the prevalence of crime and that fear of crime may be even largely independent from actual experience. 

| Standard Questions |
|:------------------:|
|       FS01         |

**Unit of measure:**
Percent (%)

**Numerator**: Number of individuals who self-report feeling safe walking alone in their neighborhood after dark

**Denominator**: Total number of individuals

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-16-01-04.docx&wdOrigin=BROWSELINK)

```{r, eval=FALSE}
table(RA_adult$FS01) # How safe do you feel walking alone in your area after dark? Very safe, fairly safe, bit unsafe, very unsafe?
```
```{r, eval=FALSE}
RA_adult <- RA_adult %>%
  mutate(
  C160105 = case_when(
    FS01 == 1 | FS01 == 2 ~ 1,     # Assign 1 for Yes (feels safe)
    FS01 == 3 | FS01 == 4 | FS01 == 5 | FS01 == 98 ~ 0,  # Assign 2 for No (does not feel safe)
    TRUE ~ NA_real_                 # Assign NA for any other values (if needed)
  )
)

```
```{r, eval=FALSE}
RA_adult <- RA_adult %>%
   mutate(
    C160105 = labelled(
      C160105,
      labels = c(
        "Yes" = 1,  # Label for Yes (1)
        "No" = 0    # Label for No (2)
      ),
      label = "Proportion of people that feel safe walking alone in their neighbourhood after dark"  # Assign the variable label
    )
  )
```
```{r, eval=FALSE}
table(RA_adult$C160105)
```

### Figure for SDG 16.1.4 by Population Groups


```{r, eval=FALSE}
###Table standard 


FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )


C160105 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%                     # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "SDG16_1_4",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C160105, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C160105, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 16.4.1",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )
```

### Figure for SDG 16.4.1 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity

C160105_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG16.4.1",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(C160105), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C160105, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )



ggplot(C160105_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of adults who self-report feeling safe walking alone in their neighborhood after dark",
    x = "Gender ",
    y = "Those who declare feeling safe",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )
```


## 16.3.3 SDG Indicator

**16.3.3 Proportion of the population who have experienced a dispute in the past two years and who accessed a formal or informal dispute resolution mechanism, by type of mechanism**

Indicator Code: C160303

**Definition:**

Number of persons who experienced a dispute during the past two years who accessed a formal or informal dispute resolution mechanism, as a percentage of all those who experienced a dispute in the past two years, by type of mechanism.

| Standard Questions                                                                                                                         |
|:------------------------------------------------------------------------------------------------------------------------------------------:|
| Justice01, Justice05, Justice07a, Justice07b, Justice07c, Justice07d,Justice07e,  Justice07f, Justice07h, Justice07g, Justice07i, Justice16|

**Concepts:**

*A dispute* can be understood as a justiciable problem between individuals or between individual(s) and an entity. Justiciable problems can be seen as the ones giving rise to legal issues, whether or not the problems are perceived as being “legal” by those who face them, and whether or not any legal action was taken as a result of the problem.

*Dispute resolution mechanisms* vary across countries around the world. While in many countries courts represent the main institution dealing with disputes of civil nature, the same may not be true in countries or societies where the first point of reference in such cases are informal systems, tradi-tional or religious leaders.

**Unit of measure:**
Percent (%)

**Numerator**: Number of persons who experienced a dispute during the past two years who accessed a formal or informal dispute resolution mechanism

**Denominator**: Number of those who experiences a dispute in the past two years and did not voluntarily self-exclude.

As per the SDG metadata guidance, it is important to exclude from the denominator those who experience disputes and do not turn to dispute resolution mechanisms because they do not need them (voluntarily self-excluded). This refers to cases where the dispute is simple or when respondents solve the issue with the other party through direct negotiation. 

**Limitations:** 
Variabale "Justice16" is not present in all countries where FDS is carried out. This variable is needed to exclude from the denominator those who voluntary self-exclude. For countries, where this variable is not present, "Case 2" below contains the calculation script.In these cases, the final indicator calculation does not correspond completely to the SDG 16.3.3 indicator. 

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-16-03-03.docx&wdOrigin=BROWSELINK)
```{r, eval=FALSE}
table(RA_adult$Justice01) #In the past two years while in the host country, have you had any disputes?
table(RA_adult$Justice03) #Which of the disputes you mentioned was the most recent? - Dispute type 
table(RA_adult$Justice05) #Did you or someone acting on your behalf try to seek information, advice or representation to help you better understand or resolve your dispute?  
#Justice07 - Did any of the following things happen while you were dealing with this dispute? Please note that when I say 'you' here, I mean you or somebody acting on your behalf. And when I say 'other party', I mean the other party involved in the dispute. 
table(RA_adult$Justice07a)#You communicated with the other party.
table(RA_adult$Justice07b)#You or the other party made a claim to, or made use of, a court/tribunal.
table(RA_adult$Justice07c)#You or the other party made a claim to, or made use of, an [Indigenous/ customary] dispute resolution process such as [INSERT examples].
table(RA_adult$Justice07d)#The problem was reported to the police or other prosecution authority.
table(RA_adult$Justice07e)#You or the other party asked for the intervention of another state authority such as [INSERT examples].
table(RA_adult$Justice07f)#You or the other party asked for the intervention of a religious authority.
table(RA_adult$Justice07g)#You or the other party asked for the intervention of a community leader such as [INSERT example].
table(RA_adult$Justice07h)#You participated in formal mediation, conciliation or arbitration [INSERT examples].
table(RA_adult$Justice07i)#There was no negotiation or third party involvement.
#table(RA_adult$Justice16) #Why didn’t you seek independent advice to help resolve this dispute?  - Check if this variable is present in your data set. 
```
```{r, eval=FALSE}

#Step 1: Identify individuals who experienced a dispute in the past two years 
RA_adult <- RA_adult %>%
  mutate(dispute = case_when(
    Justice01 == 1 ~ 1, # Assigns 1 for yes
    Justice01 == 2 ~ 0, # Assigns 2 for no
    TRUE ~ NA_real_))   # Handle missing cases or "99 - Refuse to answer". 
```
```{r, eval=FALSE}
#Step 2: Identify individuals who voluntarily self-excluded themselves from seeking formal or informal dispute resolution mechanism. 
#RA_adult<- RA_adult %>%
 # mutate(selfexclusion = case_when(
 #   Justice01 == 1 & Justice05 == 2 & Justice16 %in% c("A", "B", "C", "D", "I","L", "M") ~ 1, #Assign 1 for those who self-excluded
 #   Justice01 == 1 & Justice05 == 1 ~ 2,
  #  Justice01 == 1 & Justice05 == 2 & Justice16 %in% c("E", "F", "G", "H", "J", "K", "OT", "RF") ~ 0 )) #Assign 2 for those who did not self-exclude
```

```{r, eval=FALSE}
#Step 4: Identify individuals who accessed a formal or informal dispute resolution mechanism. 
RA_adult <- RA_adult %>%
  mutate(resolution = case_when(
    Justice01 == 1 & (Justice07b == 1 | Justice07c == 1 | Justice07d == 1  | Justice07e == 1 | Justice07f == 1 | Justice07g == 1 | Justice07h == 1) ~ 1, # Assigns 1 for yes - accessed a formal or informal dispute resolution mechanism
    Justice01 == 1 & Justice07b %in% c(2,99) & Justice07c %in% c(2,99) & Justice07d %in% c(2,99) & Justice07e %in% c(2,99) & Justice07f %in% c(2,99) & Justice07g %in% c(2,99) &        Justice07h %in% c(2,99) ~ 0)) # Assigns 2 for no - no involvement of a formal or informal dispute resolution mechanism
```

```{r}
#Step 5: Define numerator and denominator
#RA_adult <- RA_adult %>%
  #mutate(C160303_num = case_when(
   # dispute == 1 & resolution == 1 ~ 1, #Those who have experienced a dispute in the past two years and who accessed a formal or informal dispute resolution mechanism
    #TRUE ~ 0))
#RA_adult <- RA_adult %>%
  #mutate(C160303_den = case_when(
    #dispute == 1 & selfexclusion !=1 ~ 1, #
   # TRUE ~ 0)) #Those who experiences a dispute in the past two years and did not voluntarily self-exclude.

```

### Figure for SDG 16.3.3 by Population Groups

```{r, eval=FALSE}


###Results of the indicator table

#FDS_PAK_2024_RA_adult <- RA_adult %>%
 # as_survey_design(
    #ids = NULL,           # Specify the column with cluster IDs
    #weights = NULL, # Specify the column with survey weights
    #nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

##Table 

#C160303 <- FDS_PAK_2024_RA_adult %>%
  #filter(!is.na(Intro_07)) %>%         # Exclude if pop_groups is NA
  #group_by(Intro_07) %>%                  # Group by pop_groups
  #summarise(
  #  var_name = "SDG16.3.3",                        # Name of the variable
   # num_obs_uw = survey_total(!is.na(C160303_den), na.rm = TRUE),  # Unweighted total count
   # denominator = survey_total(C160303_den, na.rm = TRUE),         # Weighted total count
   # C160303_num_total = survey_total(C160303_num, na.rm = TRUE),   # Total for C160303_num
   # C160303_den_total = survey_total(C160303_den, na.rm = TRUE)    # Total for C160303_den
  #) %>%
 # mutate(
   # mean_value = round(C160303_num_total / C160303_den_total, 4)  # Calculate the mean value
  #)


##Figure 


#ggplot(C160303, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
 # geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +  # Corrected the misplaced `width`
  #geom_text(aes(label = round(mean_value, 2)), 
            #vjust = -0.5, position = position_dodge(width = 0.7)) +  # Correct text positioning
  #scale_y_continuous(limits = c(0, 1.2), expand = c(0, 0)) +
  #labs(
   # title = "Results of SDG 16.3.3",
   # x = "Population Groups",
   # y = "Mean Value"
 # ) +
  #scale_fill_unhcr_d() +  # Use UNHCR color palette
  #theme_unhcr() +         # Apply UNHCR theme
  #theme(
  #  axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  #)

```

### Figure for SDG 16.3.3 by Gender, Disability and Population Groups


```{r, eval=FALSE}

###Table with gender and disability included for the chart

#C160303_AGD <- FDS_PAK_2024_RA_adult %>%
  #filter(!is.na(Intro_07) & !is.na(disability_RA) & !is.na(HH_02_RA)) %>%         # Exclude if pop_groups is NA
  #group_by(Intro_07, disability_RA,HH_02_RA) %>%                  # Group by pop_groups
  #summarise(
  #  var_name = "SDG16.3.3",                        # Name of the variable
   # num_obs_uw = survey_total(!is.na(C160303_den), na.rm = TRUE),  # Unweighted total count
   # denominator = survey_total(C160303_den, na.rm = TRUE),         # Weighted total count
   # C160303_num_total = survey_total(C160303_num, na.rm = TRUE),   # Total for C160303_num
   # C160303_den_total = survey_total(C160303_den, na.rm = TRUE)    # Total for C160303_den
  #) %>%
 # mutate(
   # mean_value = round(C160303_num_total / C160303_den_total, 4)  # Calculate the mean value
  #)

###Chart for the above table


#ggplot(C160303_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  #geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  #geom_text(aes(label = sprintf("%.2f", mean_value)), 
   #         position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
 # facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  #labs(
   # title = "Proportion of the population who have experienced a dispute in the past two years and who accessed a formal or informal dispute resolution mechanism, by type of mechanism",
   # x = "Gender ",
   # y = "Proportion of population",
   # fill = "Disability Status"
 # ) +
 # scale_fill_unhcr_d() +  # Use UNHCR color palette
  #scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  #theme_unhcr() +  # Apply UNHCR theme
  #theme(
  #  axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  #)
```

### Figure for SDG 16.3.3 by Population Groups and dispute type

```{r, eval=FALSE}

###Table with dispute type included for the chart

#C160303_DT <- FDS_PAK_2024_RA_adult %>%
  #filter(!is.na(Intro_07) & Justice03) %>%         # Exclude if pop_groups is NA
  #group_by(Intro_07,Justice03) %>%                  # Group by pop_groups
  #summarise(
  #  var_name = "SDG16.3.3",                        # Name of the variable
   # num_obs_uw = survey_total(!is.na(C160303_den), na.rm = TRUE),  # Unweighted total count
   # denominator = survey_total(C160303_den, na.rm = TRUE),         # Weighted total count
   # C160303_num_total = survey_total(C160303_num, na.rm = TRUE),   # Total for C160303_num
   # C160303_den_total = survey_total(C160303_den, na.rm = TRUE)    # Total for C160303_den
  #) %>%
 # mutate(
   # mean_value = round(C160303_num_total / C160303_den_total, 4)  # Calculate the mean value
  #)

###Chart for the above table


#ggplot(C160303_DT, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  #geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  #geom_text(aes(label = sprintf("%.2f", mean_value)), 
   #         position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
 # facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  #labs(
   # title = "Proportion of the population who have experienced a dispute in the past two years and who accessed a formal or informal dispute resolution mechanism, by type of mechanism",
   # x = "Gender ",
   # y = "Proportion of population",
   # fill = "Disability Status"
 # ) +
 # scale_fill_unhcr_d() +  # Use UNHCR color palette
  #scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  #theme_unhcr() +  # Apply UNHCR theme
  #theme(
  #  axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  #)
```
## 16.9.1 SDG Indicator

**16.9.1 Proportion of children under 5 years of age whose births have been registered with a civil authority, by age**

Indicator Code: C160901

**Definition:**

Proportion of children under 5 years of age whose births have been registered with a civil authority.

**Concepts:**

• Birth registration: Birth registration is defined as ‘the continuous, permanent and universal recording, within the civil registry, of the occurrence and characteristics of births in accordance with the legal requirements of a country’.

• Birth certificate: A birth certificate is a vital record that documents the birth of a child. The term ‘birth certificate’ can refer either to the original document certifying the circumstances of the birth, or to

a certified copy or representation of the registration of that birth, depending on the practices of the country issuing the certificate.

• Civil authority: Official authorized to register the occurrence of a vital event and to record the required details

| Standard Questions|
|:-----------------:|
| HH_07b, HH_07a    |

**Unit of measure:**
Percent (%) of children under 5 years of age

**Numerator**: Number of children under age of five whose births are reported as being registered with the relevant national civil authorities

**Denominator**: Total number of children under the age of five 

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-16-09-01.docx&wdOrigin=BROWSELINK)
```{r, eval=FALSE}
HHroster$HH_07a # Does [name] have a birth certificate?
HHroster$HH_07b # Has [name]’s birth been registered with the [civil authorities]?
```
```{r, eval=FALSE}
# Step 1:Identify children who have a birth certificate
HHroster <- HHroster %>%
  mutate(birthCertificate = case_when(
    HH_07a == 1 ~ 1, # Assigns 1 for yes
    HH_07a == 2 ~ 0, # Assigns 2 for no
    HH_07a %in% c(98, 99) ~ NA_real_,  # Assign NA for 98 and 99
    TRUE ~ NA_real_  # Handle any other missing or unexpected values
  )) %>%
  mutate(birthCertificate = labelled(
    birthCertificate,
    labels = c(
      'Yes' = 1,
      'No' = 0
    ),
    label = "Children under 5 with a birth certificate"
  ))

```
```{r, eval=FALSE}
# Step 2:Identify children whose birth has been registered with civil authorities
HHroster <- HHroster %>%
  mutate(birthRegistered = case_when(
    HH_07b == 1 ~ 1, # Assigns 1 for yes
    HH_07b == 2 ~ 0, # Assigns 2 for no
    HH_07b %in% c(98, 99) ~ NA_real_,  # Assign NA for 98 and 99
    TRUE ~ NA_real_  # Handle any other missing or unexpected values
  )) %>%
  mutate(birthRegistered = labelled(
    birthRegistered,
    labels = c(
      'Yes' = 1,
      'No' = 0
    ),
    label = "Children under 5 birth registered with civil authorities"
  ))
```
```{r, eval=FALSE}
#Step 3:Create outcome1_2 variable
HHroster <- HHroster %>%
  mutate(C160901 = case_when(
    (birthRegistered == 1 | birthCertificate == 1) ~ 1,  # Child has been registered or has birth certificate
    (birthRegistered == 0 & birthCertificate == 0) ~ 0,  # Child not registered and has no birth certificate
    (is.na(birthRegistered) & birthCertificate == 0) | (birthRegistered == 0 & is.na(birthCertificate)) ~ 0,  # One is NA, the other is No
    TRUE ~ NA_real_  # Handle cases where data is missing or unknown
  )) %>%
  mutate(C160901 = labelled(
    C160901,
    labels = c(
      'Yes' = 1,
      'No' = 0
    ),
    label = "Proportion of children under 5 years of age whose births have been registered with a civil authority"
  ))
```
```{r, eval=FALSE}
table(HHroster$C160901)
```

### Figure for SDG 16.9.1 by Population Groups

```{r, eval=FALSE}
###Results of the indicator table

FDS_PAK_2024_HHroster <- HHroster %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C160901 <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(Intro_07)) %>%         # Exclude if pop groups is NA
  group_by(Intro_07) %>%                           # Group by pop_groups
  summarise(                                         # Summarise to compute values
    var_name = "outcome1_2",                          # Name of the variable
    num_obs_uw = unweighted(n()),                    # Unweighted total count
    denominator = survey_total(),                    # Weighted total count
    mean_value = survey_mean(C160901, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with NA removed
  )


##Chart for the indicator above

ggplot(C160901, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  
  scale_y_continuous(limits = c(0, 1.2), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 16.9.1",
    x = "Population Groups",
    y = "Mean Value with standard errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )

```

### Figure for SDG 16.9.1 by Population Groups and Gender

```{r, eval=FALSE}

##Table with gender and population groups - disability is not asked under 5


C160901_AGD <- FDS_PAK_2024_HHroster %>%
  filter(!is.na(HH_02) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02) %>%
  summarise(
    var_name = "outcome1_2",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(C160901), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C160901, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )


##Figure 


ggplot(C160901_AGD, aes(x = HH_02, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +
  facet_wrap(~ Intro_07) +
  labs(
    title = "Proportion of children under 5 years of age whose births have been registered with a civil authority by Gender and Population Groups",
    x = "Gender ",
    y = "Proportion of registered children"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR discrete color palette
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) + # adjust limits accordingly
  theme_unhcr() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```
## 16.b.1 SDG Indicator

**16.b.1 Proportion of population reporting having personally felt discriminated against or harassed in the previous 12 months on the basis of a ground of discrimination prohibited under international human rights law**
Indicator Code: C200204

This indicator is defined as the proportion of the population (adults) who self-report that they personally experienced discrimination or harassment during the last 12 months based on ground(s) prohibited by international human rights law (IHRL). IHRL refers to the body of international legal instruments aiming to promote and protect human rights, including the Universal Declaration of Human Rights (UDHR) and sub-sequent international human rights treaties adopted by the United Nations (UN).

The FDS discrimination module asks how often the respondent experiences discrimination in nines areas. It measures if the respondent has experienced at least one form of discrimination corresponding to the Everyday Discrimination Scale.

| Standard Questions                                                                    |
|:-------------------------------------------------------------------------------------:|
| DI01, DI01_01, DI01_02, DI01_03, DI01_04, DI01_05, DI01_06, DI01_07, DI01_08, DI01_09 |

**Unit of measure:**
Percent (%)

**Numerator**: Number of survey respondents who report experience of any form of discrimination or harassment during the last 12 months

**Denominator**: Total number of survey respondents 

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-16-0b-01.docx&wdOrigin=BROWSELINK)
2. [Guidance Note for Implementation of Survey Module on SDG Indicator 16.b.1 & 10.3.1](https://www.ohchr.org/sites/default/files/Documents/Issues/HRIndicators/SDG_Indicator_16b1_10_3_1_Guidance_Note_.pdf)

```{r, eval=FALSE}
#In the past 12 month, in your day-to-day life in the host country, how often do any of the following things happen to you? Would you say  almost every day, at least once a week, a few times a month, a few times a year, less than once a year or never?:
table(RA_adult$DI01_01) #You are treated with less politeness than other people are.
table(RA_adult$DI01_02) #You are treated with less respect than other people are.
table(RA_adult$DI01_04) #People act as if they think you are not smart.
table(RA_adult$DI01_05) #People act as if they are afraid of you.
table(RA_adult$DI01_06) #People act as if they think you are dishonest.
table(RA_adult$DI01_07) #People act as if they’re better than you are.
table(RA_adult$DI01_08) #You are called names or insulted.
table(RA_adult$DI01_09) #You are threatened or harassed.```
```
```{r, eval=FALSE}
RA_adult <- RA_adult %>%
  mutate(C200204 = case_when(
    # If any value is 1, 2, 3, 4, or 5, assign 1
    rowSums(across(c(DI01_01, DI01_02, DI01_03, DI01_04, 
                     DI01_05, DI01_06, DI01_07, DI01_08, DI01_09), ~ . %in% 1:5)) > 0 ~ 1,
    # If all values are 6, assign 2
    rowSums(across(c(DI01_01, DI01_02, DI01_03, DI01_04, 
                     DI01_05, DI01_06, DI01_07, DI01_08, DI01_09), ~ . == 6)) == 9 ~ 0,
    # If all values are 7, assign NA
    rowSums(across(c(DI01_01, DI01_02, DI01_03, DI01_04, 
                     DI01_05, DI01_06, DI01_07, DI01_08, DI01_09), ~ . == 7)) == 9 ~ NA_real_,
    TRUE ~ NA_real_
  )) %>%
  mutate(C200204 = labelled(
    C200204,
    labels = c(
      'Yes' = 1,
      'No' = 0
    ),
    label = "Proportion of population reporting having personally felt discriminated against or harassed in the previous 12 months on the basis of a ground of discrimination prohibited under international human rights law"
  ))

```
```{r, eval=FALSE}
table(RA_adult$SDG16_b_1)
```

*Limitations:* 
The methodology used for this module in the FDS differs in some aspects from the methodology described in the SDG metadata guidance. More details on the FDS methodology for the discrimination module can be found here. ADD LINK - PETRA

### Figure for SDG 16.b.1 by Population Group

```{r, eval=FALSE}

##Table by population groups

FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C200204 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG16_b_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C200204, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of outcome 16.b.1 by pop groups

ggplot(C200204, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 16.b.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```


### Figure for SDG 16.b.1 by Population Groups, Gender and Disability

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity
C200204_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(disability_RA) & !is.na(Intro_07) ) %>%  
  group_by(Intro_07, HH_02_RA,disability_RA) %>%
  summarise(
    var_name = "SDG16_b_1",                                      # Name of the variable
    num_obs_uw = survey_total(!is.na(C200204), vartype = NULL),  # Unweighted total count
    denominator = survey_total(),                                # Weighted total count
    mean_value = survey_mean(C200204, vartype = c("ci", "se"), na.rm = TRUE)  # Compute mean with CI and SE
  )



ggplot(C200204_AGD, aes(x = HH_02_RA, y = mean_value, fill = disability_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)), 
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +  # Add values on bars
  facet_wrap(~ Intro_07) +  # Create separate plots for each pop_group
  labs(
    title = "Proportion of population reporting having personally felt discriminated against or harassed in the previous 12 months.",
    x = "Gender ",
    y = "Those discriminated or harrased",
    fill = "Disability Status"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +  # Apply UNHCR theme
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for readability
  )

```



## 17.8.1 SDG Indicator

**17.8.1 Proportion of individuals using the internet**

Indicator Code: C170801
The indicator proportion of individuals using the Internet is defined as the proportion of individuals who used the Internet from any location in the last three months.

The Internet is a worldwide public computer network. It provides access to a number of communication services including the World Wide Web and carries e-mail, news, entertainment and data files,irrespective of the device used (not assumed to be only via a computer - it may also be by mobile telephone, tablet, PDA, games machine, digital TV etc.). Access can be via a fixed or mobile network.

| Standard Questions |
|:------------------:|
| IA07, IA07_1       |

**Unit of measure:**
Percent (%)

**Numerator**: Total number of in-scope individuals using the Internet (from any location) in the last 3 months

**Denominator**: Total number of in-scope individuals

**Sources** 
1. [SDG indicator metadata](https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Funstats.un.org%2Fsdgs%2Fmetadata%2Ffiles%2FMetadata-17-08-01.docx&wdOrigin=BROWSELINK)
2. [ITU Manual for Measuring ICT Access and Use by Households and Individuals 2020:](https://www.itu.int/en/ITU-D/Statistics/Pages/publications/manual.aspx)


```{r, eval=FALSE}
table(RA_adult$IA07)   #Have you used the Internet in the past 30 days?
table(RA_adult$IA07_1) #How about in the past 3 months? Have you used the Internet in the past 3 months?
```

```{r, eval=FALSE}
RA_adult <- RA_adult %>%
  mutate(C170801 = case_when(IA07 == 1 ~ 1,
                               IA07 == 2 & IA07_1 == 1 ~ 1,
                               TRUE ~ 0)) %>%
  mutate(C170801 = labelled(C170801,
                              labels = c(
                                 'Yes' = 1,
                                 'No' = 0
                               ),
                               label = "Proportion of individuals using the internet" ))
```
```{r, eval=FALSE}
table(RA_adult$C170801)
```


### Figure for SDG 17.8.1 by Population Groups

```{r, eval=FALSE}

##Table by population groups

FDS_PAK_2024_RA_adult <- RA_adult %>%
  as_survey_design(
    ids = NULL,           # Specify the column with cluster IDs
    weights = NULL, # Specify the column with survey weights
    nest = TRUE              # Use TRUE if PSUs are nested within clusters (optional, based on your survey design)
  )

###Table 

C170801 <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(Intro_07)) %>%     # Exclude if pop groups is NA
  group_by(Intro_07) %>%      # Show results disaggregated by pop groups
  summarise(                                         # put all variables here
    var_name = "SDG_17_8_1",                          # name of the variable
    num_obs_uw = unweighted(n()),                    # unweighted total count
    denominator = survey_total(),                      # weighted total count
    mean_value = survey_mean(C170801, vartype = c("ci", "se"), na.rm = TRUE) # indicator value ( weighted) with CI and SE
  )


###Chart of outcome 8_2 by pop groups

ggplot(C170801, aes(x = Intro_07, y = mean_value, fill = Intro_07)) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  geom_errorbar(aes(ymin = mean_value - mean_value_se, ymax = mean_value + mean_value_se),
                width = 0.2, position = position_dodge(0.7)) +
  geom_text(aes(label = round(mean_value, 2)), 
            vjust = -0.5, position = position_dodge(0.7)) +  # Add labels for mean_value
  scale_y_continuous(limits = c(0, 1), expand = c(0, 0)) +
  labs(
    title = "Results of SDG 17.8.1",
    x = "Population Groups",
    y = "Mean Value with Standard Errors"
  ) +
  scale_fill_unhcr_d() +  # Use UNHCR color palette (requires unhcrthemes package)
  theme_unhcr() +         # Apply UNHCR theme (requires unhcrthemes package)
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate x-axis labels for better readability
  )


```


### Figure for SDG 17.8.1 by Population Groups and Gender

```{r, eval=FALSE}
#### Table and chart that shows results by age/sex/diversity
C170801_AGD <- FDS_PAK_2024_RA_adult %>%
  filter(!is.na(HH_02_RA) & !is.na(Intro_07)) %>%
  group_by(Intro_07, HH_02_RA) %>%
  summarise(
    var_name = "SDG17_8_1",
    num_obs_uw = survey_total(!is.na(C170801), vartype = NULL),
    denominator = survey_total(),
    mean_value = survey_mean(C170801, vartype = c("ci", "se"), na.rm = TRUE)
  )

ggplot(SDG17_8_1_AGD, aes(x = HH_02_RA, y = mean_value, fill = HH_02_RA)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.7), width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", mean_value)),
            position = position_dodge(width = 0.7), vjust = -0.4, size = 3) +
  facet_wrap(~ Intro_07) +
  labs(
    title = "Proportion of individuals using the internet in the last 3 months",
    x = "Gender",
    y = "Those using the internet"
  ) +
  scale_fill_unhcr_d() +
  scale_y_continuous(limits = c(0, 1.1), expand = c(0, 0)) +
  theme_unhcr() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )


```


